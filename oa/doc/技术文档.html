<!DOCTYPE html>
<html class="theme">
<head>
    <meta charset="utf-8">
    <meta name="description" content="zx">
    <meta name="author" content="zx">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>技术文档 v5.1 </title>
    <link href="https://www.zybuluo.com/static/img/favicon.png" type="image/x-icon" rel="icon">
    <link href="https://www.zybuluo.com/static/assets/1bc053c8.base.lib.min.css" rel="stylesheet" media="screen">
    <link id="prettify-style" href="https://www.zybuluo.com/static/editor/libs/google-code-prettify/prettify-cmd.css"  type="text/css" rel="stylesheet">
    <link href="https://www.zybuluo.com/static/assets/mdeditor/45c7d56d.layout.min.css" rel="stylesheet" media="screen">

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-44461741-1', 'zybuluo.com');
        ga('send', 'pageview');
    </script>
</head>

<body class="theme">

<div id="global-prompt-alert" class="hide alert alert-warning">
    <span id="global-prompt-message"></span>
    <a id="close-global-prompt-alert" href="">[关闭]</a>
</div>

<div id="editor-reader-full" class="editor-reader-full-shown" style="position: static;">
    <div id="wmd-preview" class="wmd-preview wmd-preview-full-reader">
        <div class="md-section-divider"></div>
        <div class="md-section-divider"></div>
        <h1 data-anchor-id="yv55" id="guns-技术文档-v51">Guns 技术文档 v5.1</h1>
        <hr>
        <p data-anchor-id="sg0u">
        <div class="toc">
            <ul>
                <li><a href="#guns-技术文档-v51">Guns 技术文档 v5.1</a>
                    <ul>
                        <li><a href="#1-序言">1. 序言</a>
                            <ul>
                                <li><a href="#11-文档简介">1.1 文档简介</a></li>
                                <li><a href="#12-guns教程">1.2 Guns教程</a></li>
                                <li><a href="#13-获取帮助">1.3 获取帮助</a></li>
                            </ul>
                        </li>
                        <li><a href="#2-使用手册">2. 使用手册</a>
                            <ul>
                                <li><a href="#21-下载项目">2.1 下载项目</a></li>
                                <li><a href="#22-导入项目">2.2 导入项目</a>
                                    <ul>
                                        <li><a href="#221-eclipse导入">2.2.1 eclipse导入</a></li>
                                        <li><a href="#222-idea导入">2.2.2 IDEA导入</a></li>
                                    </ul>
                                </li>
                                <li><a href="#23-运行项目">2.3 运行项目</a></li>
                                <li><a href="#24-打包部署">2.4 打包部署</a></li>
                            </ul>
                        </li>
                        <li><a href="#3-开发手册">3. 开发手册</a>
                            <ul>
                                <li><a href="#31-了解guns">3.1 了解Guns</a>
                                    <ul>
                                        <li><a href="#311-模块结构">3.1.1 模块结构</a></li>
                                        <li><a href="#312-包结构说明">3.1.2 包结构说明</a></li>
                                    </ul>
                                </li>
                                <li><a href="#32-实战开发">3.2 实战开发</a>
                                    <ul>
                                        <li><a href="#321-建表">3.2.1 建表</a></li>
                                        <li><a href="#322-代码生成">3.2.2 代码生成</a></li>
                                        <li><a href="#333-添加菜单与分配权限">3.3.3 添加菜单与分配权限</a></li>
                                        <li><a href="#334-编写业务代码">3.3.4 编写业务代码</a></li>
                                    </ul>
                                </li>
                                <li><a href="#33-权限控制与校验">3.3 权限控制与校验</a>
                                    <ul>
                                        <li><a href="#331-用户角色和资源">3.3.1 用户，角色和资源</a></li>
                                        <li><a href="#332-如何对资源进行权限控制">3.3.2 如何对资源进行权限控制</a></li>
                                        <li><a href="#333-前端页面对权限资源的显示">3.3.3 前端页面对权限资源的显示</a></li>
                                    </ul>
                                </li>
                                <li><a href="#34-多数据源的使用">3.4 多数据源的使用</a></li>
                                <li><a href="#35-如何分页">3.5 如何分页</a>
                                    <ul>
                                        <li><a href="#351-简单查询的分页">3.5.1 简单查询的分页</a></li>
                                        <li><a href="#352-复杂查询的分页">3.5.2 复杂查询的分页</a></li>
                                        <li><a href="#353-获取前端表格插件传值">3.5.3 获取前端表格插件传值</a></li>
                                    </ul>
                                </li>
                                <li><a href="#36-数据范围">3.6 数据范围</a>
                                    <ul>
                                        <li><a href="#361-介绍">3.6.1 介绍</a></li>
                                        <li><a href="#362-如何使用">3.6.2 如何使用</a></li>
                                        <li><a href="#363-原理">3.6.3 原理</a></li>
                                    </ul>
                                </li>
                                <li><a href="#37-guns-rest模块的使用">3.7 guns-rest模块的使用</a>
                                    <ul>
                                        <li><a href="#371-关于jwt鉴权">3.7.1 关于jwt鉴权</a></li>
                                        <li><a href="#372-关于传输数据的签名">3.7.2 关于传输数据的签名</a></li>
                                        <li><a href="#373-guns-rest模块的运行流程">3.7.3 guns-rest模块的运行流程</a></li>
                                        <li><a href="#374-运行原理">3.7.4 运行原理</a></li>
                                    </ul>
                                </li>
                                <li><a href="#38-工作流">3.8 工作流</a></li>
                                <li><a href="#39-日志记录">3.9 日志记录</a>
                                    <ul>
                                        <li><a href="#391-业务日志">3.9.1 业务日志</a></li>
                                        <li><a href="#392-异常日志">3.9.2 异常日志</a></li>
                                    </ul>
                                </li>
                                <li><a href="#310-如何使用缓存">3.10 如何使用缓存</a>
                                    <ul>
                                        <li><a href="#3101-用工具类操作">3.10.1 用工具类操作</a></li>
                                        <li><a href="#3102-用spring-cache操作缓存">3.10.2 用spring cache操作缓存</a></li>
                                    </ul>
                                </li>
                                <li><a href="#311-使用枚举">3.11 使用枚举</a></li>
                                <li><a href="#312-spring-boot热部署">3.12 spring boot热部署</a>
                                    <ul>
                                        <li><a href="#3121-重新加载html">3.12.1 重新加载html</a></li>
                                        <li><a href="#3122-重新加载java类">3.12.2 重新加载java类</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li><a href="#4-扩展与高级配置">4. 扩展与高级配置</a>
                            <ul>
                                <li><a href="#41-修改项目名和包名">4.1 修改项目名和包名</a>
                                    <ul>
                                        <li><a href="#411-修改项目名">4.1.1 修改项目名</a></li>
                                        <li><a href="#412-修改包名">4.1.2 修改包名</a></li>
                                    </ul>
                                </li>
                                <li><a href="#42-放过接口权限验证">4.2 放过接口权限验证</a></li>
                                <li><a href="#43-静态资源和模板位置的变更">4.3 静态资源和模板位置的变更</a></li>
                                <li><a href="#44-三个或更多数据源如何配置">4.4 三个或更多数据源如何配置</a></li>
                                <li><a href="#45-添加登录验证码">4.5 添加登录验证码</a></li>
                                <li><a href="#46-spring-profile">4.6 spring profile</a></li>
                                <li><a href="#47-多机器部署开启spring-session">4.7 多机器部署开启spring session</a></li>
                                <li><a href="#48-使用redis">4.8 使用Redis</a></li>
                                <li><a href="#49-xss过滤器">4.9 XSS过滤器</a>
                                    <ul>
                                        <li><a href="#491-介绍">4.9.1 介绍</a></li>
                                        <li><a href="#492-原理">4.9.2 原理</a></li>
                                        <li><a href="#493-放过过滤">4.9.3 放过过滤</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li><a href="#5-核心思想">5. 核心思想</a>
                            <ul>
                                <li><a href="#51-分包">5.1 分包</a></li>
                                <li><a href="#52-统一异常拦截">5.2 统一异常拦截</a>
                                    <ul>
                                        <li><a href="#521-介绍">5.2.1 介绍</a></li>
                                        <li><a href="#522-优点">5.2.2 优点</a></li>
                                        <li><a href="#523-关于性能">5.2.3 关于性能</a></li>
                                    </ul>
                                </li>
                                <li><a href="#53-结果包装器">5.3 结果包装器</a>
                                    <ul>
                                        <li><a href="#531-如何使用">5.3.1 如何使用</a></li>
                                        <li><a href="#532-constantfactory">5.3.2 ConstantFactory</a></li>
                                    </ul>
                                </li>
                                <li><a href="#54-前端思想">5.4 前端思想</a>
                                    <ul>
                                        <li><a href="#541-布局">5.4.1 布局</a></li>
                                        <li><a href="#542-标签">5.4.2 标签</a></li>
                                        <li><a href="#543-手动新增标签页">5.4.3 手动新增标签页</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li><a href="#6-常见问题答疑">6. 常见问题答疑</a>
                            <ul>
                                <li><a href="#61-默认的系统登录账号和密码是多少">6.1 默认的系统登录账号和密码是多少</a></li>
                                <li><a href="#62-权限异常">6.2 权限异常</a></li>
                                <li><a href="#63-为何分页是前端实现">6.3 为何分页是前端实现</a></li>
                                <li><a href="#64-关于ctxpath">6.4 关于${ctxPath}</a></li>
                                <li><a href="#65-放过某些url的权限验证">6.5 放过某些url的权限验证</a></li>
                                <li><a href="#66-主页的搜索功能">6.6 主页的搜索功能</a></li>
                                <li><a href="#67-运行sql报错">6.7 运行sql报错</a></li>
                                <li><a href="#68-关于打包">6.8 关于打包</a></li>
                                <li><a href="#69-查询结果的驼峰转化问题">6.9 查询结果的驼峰转化问题</a></li>
                                <li><a href="#610-为何使用beetl">6.10 为何使用beetl</a></li>
                                <li><a href="#611-为何有的业务没有service层">6.11 为何有的业务没有service层</a></li>
                                <li><a href="#612-为何既有dao又有mapper">6.12 为何既有dao，又有mapper</a></li>
                                <li><a href="#613-提示springactive错误">6.13 提示@spring.active@错误</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        </p>
        <hr>
        <div class="md-section-divider"></div>
        <h2 data-anchor-id="8xdq" id="1-序言">1. 序言</h2>
        <div class="md-section-divider"></div>
        <p data-anchor-id="5v6e">本文档基于最新的Guns版本，集<code>Guns使用手册</code>，<code>Guns开发手册</code>，<code>Guns核心思想</code>等于一体，Guns官方git地址： <a href="https://gitee.com/stylefeng/guns" target="_blank">https://gitee.com/stylefeng/guns</a>。
        </p>
        <div class="md-section-divider"></div>
        <hr>
        <div class="md-section-divider"></div>
        <h2 data-anchor-id="ism1" id="2-使用手册">2. 使用手册</h2>
        <p data-anchor-id="fu31"><strong>注意：</strong></p>
        <blockquote data-anchor-id="5ke6" class="white-blockquote">
            <ul>
                <li>Guns运行环境：JDK1.8</li>
                <li>maven 3.3.9或更高</li>
                <li>
                    <a href="https://www.baidu.com/baidu?wd=maven+%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F&amp;tn=monline_4_dg&amp;ie=utf-8"
                       target="_blank">请使用阿里云maven镜像</a></li>
                <li>作者当前使用开发工具为IDEA 2018.1.4</li>
            </ul>
        </blockquote>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="j331" id="21-下载项目">2.1 下载项目</h3>
        <p data-anchor-id="nslk">登录码云平台，打开<a href="https://gitee.com/stylefeng/guns" target="_blank">Guns主页</a>，点击下载按钮下载
            <br>
            <img src="http://static.zybuluo.com/stylefeng/xxy94414xlypettx7309sa81/image_1c4hmao6j5bmvv91cg51vqlqvd1s.png"
                 alt="image_1c4hmao6j5bmvv91cg51vqlqvd1s.png-118.4kB" title=""></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="myyc" id="22-导入项目">2.2 导入项目</h3>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="prsa" id="221-eclipse导入">2.2.1 eclipse导入</h4>
        <ol data-anchor-id="2brq">
            <li><p>导入之前请检查eclipse的maven配置是否本机所安装的maven（一般不用eclipse自带的maven），如下 <br>
                <img src="http://static.zybuluo.com/stylefeng/zvccx2auafcmk47m2olgpv1m/image_1c4hnssmqqcl99t1iq1r4q1vgm29.png"
                     alt="image_1c4hnssmqqcl99t1iq1r4q1vgm29.png-60.2kB" title=""></p></li>
            <li><p>检查maven安装目录下的settings.xml是否配置了阿里云镜像 <br>
                <img src="http://static.zybuluo.com/stylefeng/wty2hw1v1wfcxs4efexnqjdp/image_1c4hnv9u49e81sns188p16041n3n2m.png"
                     alt="image_1c4hnv9u49e81sns188p16041n3n2m.png-9.8kB" title=""></p></li>
            <li><p>再次检查eclipse中maven的配置是否应用了当前maven安装目录的settings.xml配置文件（个人习惯全局和用户配置设置为一个），如下 <br>
                <img src="http://static.zybuluo.com/stylefeng/j7g5i1doeboimexr3qulerwh/image_1c4ho2i5pkq52e71d3a1il91gld33.png"
                     alt="image_1c4ho2i5pkq52e71d3a1il91gld33.png-58.7kB" title=""></p></li>
            <li><p>以上设置完成，需要重启一下eclipse</p></li>
            <li><p>点击eclipse菜单File-&gt;import，出现如下界面，选择<code>Existing maven project</code> <br>
                <img src="http://static.zybuluo.com/stylefeng/te3awarhudpat2b5xdds5tu1/image_1c4hoa3t0a0o1q1i1gng1qbe1nai3g.png"
                     alt="image_1c4hoa3t0a0o1q1i1gng1qbe1nai3g.png-39.6kB" title=""></p></li>
            <li><p>找到下载的项目目录，并点击所有模块，之后点击Finish，导入成功</p></li>
        </ol>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="p8xe" id="222-idea导入">2.2.2 IDEA导入</h4>
        <ol data-anchor-id="nm2v">
            <li><p>同样，导入前检查IDEA的maven配置是否正确 <br>
                <img src="http://static.zybuluo.com/stylefeng/y3nb3qbnmfvosme9j9moxefe/image_1c4j6lfd113i71qdeqimt9usf5m.png"
                     alt="image_1c4j6lfd113i71qdeqimt9usf5m.png-228.6kB" title=""></p></li>
            <li><p>检查maven安装目录下的settings.xml是否配置了阿里云镜像(同<code>2.2.1节</code>第<code>2</code>步)</p></li>
            <li><p>进入IDEA主界面，点击open，并选择下载好的guns代码的根目录 <br>
                <img src="http://static.zybuluo.com/stylefeng/on697jjgn3xbhjw6jy99rlzw/image_1c4j6ssdt1ip35nqsqeb231f7g13.png"
                     alt="image_1c4j6ssdt1ip35nqsqeb231f7g13.png-40.5kB" title=""></p></li>
        </ol>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="nbd4" id="23-运行项目">2.3 运行项目</h3>
        <p data-anchor-id="piiy">运行前的准备:</p>
        <blockquote data-anchor-id="30rb" class="white-blockquote">
            <ul>
                <li>安装mysql数据库，作者所用mysql版本为5.7</li>
            </ul>
        </blockquote>
        <ol data-anchor-id="uhmj">
            <li><p>执行<code>guns-admin</code>模块下的<code>sql/guns.sql</code>脚本，初始化guns的数据库环境</p></li>
            <li><p>打开<code>guns-admin/src/main/resources/application.yml</code>配置文件，修改<code>数据连接</code>，<code>账号</code>和<code>密码</code>，改为您所连接数据库的配置,local为本地开发环境，dev为开发服务器的环境，test为测试服务器的环境，produce为正式上线的环境
                <br>
                <img src="http://static.zybuluo.com/stylefeng/dr9x6yw3jl7c3wjyw4tfg9uf/image_1cprhp62fts184a1m1cei8f6n9.png"
                     alt="image_1cprhp62fts184a1m1cei8f6n9.png-37.5kB" title=""></p></li>
            <li><p>如需修改服务器端口或者context-path，默认的context-path为<code>/</code>，可参考下图 <br>
                <img src="http://static.zybuluo.com/stylefeng/c63t2ff7sr3gbvpxmq050cag/image_1ch7lopru1ptj1i9u1smfr5s1ag2m.png"
                     alt="image_1ch7lopru1ptj1i9u1smfr5s1ag2m.png-11.2kB" title=""></p></li>
            <li><p>执行<code>GunsApplication</code>类中的main方法，即可运行Guns系统</p></li>
            <li><p>打开浏览器，输入<code>localhost:8080</code>，即可访问到Guns的登录页面，默认登录账号密码:
                <strong><code>admin/111111</code></strong></p></li>
        </ol>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="3mif" id="24-打包部署">2.4 打包部署</h3>
        <p data-anchor-id="5erx">目前Guns支持两种打包方式，即<code>jar包</code>和<code>war包</code></p>
        <ol data-anchor-id="rtlu">
            <li><p>打包之前修改<code>guns-admin.pom</code>中的<code>packaging</code>节点，改为<code>jar</code>或者<code>war</code> <br>
                <img src="http://static.zybuluo.com/stylefeng/p6zl47xt6lmrt1j2wqbjylu3/image_1c4j9c41o15jh17psgso3cdspf34.png"
                     alt="image_1c4j9c41o15jh17psgso3cdspf34.png-142.1kB" title=""></p></li>
            <li><p>在项目的<code>guns-parent</code>目录执行maven 命令<code>clean package -Dmaven.test.skip=true</code>，即可打包，如下
                <br>
                <img src="http://static.zybuluo.com/stylefeng/g87qhnu8qa8vzailpurxmmvl/image_1cpri2cmj1a1enr310ptb3k1tfjp.png"
                     alt="image_1cpri2cmj1a1enr310ptb3k1tfjp.png-95.7kB" title=""> <br>
                <img src="http://static.zybuluo.com/stylefeng/z3odk9brz9r9g8nelfxd0y3n/image_1c4j9fht81l07o7g10bk1e7g109a3h.png"
                     alt="image_1c4j9fht81l07o7g10bk1e7g109a3h.png-34.1kB" title=""></p></li>
            <li><p>命令执行成功后，在<code>guns-admin/target</code>目录下即可看到打包好的文件 <br>
                <img src="http://static.zybuluo.com/stylefeng/tlpd794l1q7tbejvq94lpt1o/image_1cprj62u51dqp10vd1c27j6cfkl16.png"
                     alt="image_1cprj62u51dqp10vd1c27j6cfkl16.png-63.5kB" title=""></p></li>
        </ol>
        <p data-anchor-id="oj7y">提示：若打的包为jar包，可通过<code>java -jar guns-admin-1.0.0-SNAPSHOT.jar</code>来启动Guns系统</p>
        <hr>
        <div class="md-section-divider"></div>
        <h2 data-anchor-id="ps9u" id="3-开发手册">3. 开发手册</h2>
        <p data-anchor-id="dlla"><strong>用Guns开发手头常备如下几个工具:</strong></p>
        <blockquote data-anchor-id="gf53" class="white-blockquote">
            <ul>
                <li>H+ 4.2源代码： 群文件里有</li>
                <li>mybatis-plus文档：<a href="http://mp.baomidou.com/" target="_blank">http://mp.baomidou.com/</a></li>
                <li>beetl文档：<a href="http://ibeetl.com/guide/#beetl" target="_blank">http://ibeetl.com/guide/#beetl</a>
                </li>
                <li>laydate和layer组件文档：<a href="http://www.layui.com/alone.html" target="_blank">http://www.layui.com/alone.html</a>
                </li>
                <li>Spring Boot文档：<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/"
                                     target="_blank">https://docs.spring.io/spring-boot/docs/current/reference/html/</a>
                </li>
            </ul>
        </blockquote>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="11j4" id="31-了解guns">3.1 了解Guns</h3>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="fyu9" id="311-模块结构">3.1.1 模块结构</h4>
        <p data-anchor-id="cyad">新版的5.1版本的Guns结构，开发环境由多模块变成了单模块，化繁为简，返璞归真， <br>
            <img src="http://static.zybuluo.com/stylefeng/qflnfzxb1zpibtp21tt3vbjr/image_1cprjb85s1qm2ja91cj111qulf41j.png"
                 alt="image_1cprjb85s1qm2ja91cj111qulf41j.png-66kB" title=""></p>
        <p data-anchor-id="p5af">但是pom中还是依赖了作者开发的两个其他模块， <br>
            <img src="http://static.zybuluo.com/stylefeng/lqyc0kq9l5zbj635fk83vg2y/image_1cprjcdj5vdjtr43fr1h5jum120.png"
                 alt="image_1cprjcdj5vdjtr43fr1h5jum120.png-58.1kB" title=""></p>
        <p data-anchor-id="10y0">这俩模块作者已经上传到maven的中央仓库中（<a href="https://search.maven.org/search?q=cn.stylefeng"
                                                           target="_blank">https://search.maven.org/search?q=cn.stylefeng</a>）
        </p>
        <blockquote data-anchor-id="64ks" class="white-blockquote">
            <p><code>guns-generator</code>为代码生成模块，其中代码生成模块整合了mybatis-plus的代码生成器和guns独有的代码生成器，可以一键生成entity，dao，service，html，js等代码，可减少很多开发新模块的工作量，此模块的gitee地址为<a
                    href="https://gitee.com/stylefeng/guns-generator" target="_blank">https://gitee.com/stylefeng/guns-generator</a>
            </p>

            <p><code>kernel-core</code>模块为抽象出的核心（通用）模块，以供其他模块调用，此模块主要封装了一些通用的工具类，公共枚举，常量，配置等等，此模块的gitee地址是<a
                    href="https://gitee.com/stylefeng-Roses/roses-kernel" target="_blank">https://gitee.com/stylefeng-Roses/roses-kernel</a>
            </p>
        </blockquote>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="8z2q" id="312-包结构说明">3.1.2 包结构说明</h4>
        <p data-anchor-id="mplk"><img
                src="http://static.zybuluo.com/stylefeng/awd706os2ycf3chz5iht44xs/image_1cpuek1o0a3p12p81hii1ic31pa69.png"
                alt="image_1cpuek1o0a3p12p81hii1ic31pa69.png-125.4kB" title=""></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="jvel" id="32-实战开发">3.2 实战开发</h3>
        <p data-anchor-id="fsc2"><strong>Guns开发三部曲 -&gt; 1.建表 2.代码生成 3.添加菜单 4.适配业务代码</strong></p>
        <p data-anchor-id="lunc">下面以一个<code>订单业务</code>为例，实战演练如何用Guns编写简单的增删改查业务</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="asp5" id="321-建表">3.2.1 建表</h4>
        <p data-anchor-id="uh77">新建订单表如下: <br>
            <img src="http://static.zybuluo.com/stylefeng/f8fgcmsmbcne9rpbzxwhf0w0/image_1c4k94iouk5ep8ttl72011loi9.png"
                 alt="image_1c4k94iouk5ep8ttl72011loi9.png-31.5kB" title=""></p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="faxo"><ol class="linenums"><li class="L0"><code><span
                class="pln">DROP TABLE IF EXISTS </span><span class="str">`biz_order`</span><span
                class="pun">;</span></code></li><li class="L1"><code><span class="pln">CREATE TABLE </span><span
                class="str">`biz_order`</span><span class="pln"> </span><span class="pun">(</span></code></li><li
                class="L2"><code><span class="pln">  </span><span class="str">`id`</span><span class="pln"> </span><span
                class="kwd">int</span><span class="pun">(</span><span class="lit">11</span><span
                class="pun">)</span><span class="pln"> NOT NULL AUTO_INCREMENT COMMENT </span><span
                class="str">'主键'</span><span class="pun">,</span></code></li><li class="L3"><code><span
                class="pln">  </span><span class="str">`goods_name`</span><span class="pln"> varchar</span><span
                class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> DEFAULT NULL COMMENT </span><span
                class="str">'商品名称'</span><span class="pun">,</span></code></li><li class="L4"><code><span
                class="pln">  </span><span class="str">`place`</span><span class="pln"> varchar</span><span class="pun">(</span><span
                class="lit">255</span><span class="pun">)</span><span class="pln"> DEFAULT NULL COMMENT </span><span
                class="str">'下单地点'</span><span class="pun">,</span></code></li><li class="L5"><code><span
                class="pln">  </span><span class="str">`create_time`</span><span class="pln"> datetime DEFAULT NULL COMMENT </span><span
                class="str">'下单时间'</span><span class="pun">,</span></code></li><li class="L6"><code><span
                class="pln">  </span><span class="str">`user_name`</span><span class="pln"> varchar</span><span
                class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> DEFAULT NULL COMMENT </span><span
                class="str">'下单用户名称'</span><span class="pun">,</span></code></li><li class="L7"><code><span
                class="pln">  </span><span class="str">`user_phone`</span><span class="pln"> varchar</span><span
                class="pun">(</span><span class="lit">255</span><span class="pun">)</span><span class="pln"> DEFAULT NULL COMMENT </span><span
                class="str">'下单用户电话'</span><span class="pun">,</span></code></li><li class="L8"><code><span class="pln">  PRIMARY KEY </span><span
                class="pun">(</span><span class="str">`id`</span><span class="pun">)</span><span class="pln"> USING BTREE</span></code></li><li
                class="L9"><code><span class="pun">)</span><span class="pln"> ENGINE</span><span
                class="pun">=</span><span class="typ">InnoDB</span><span class="pln"> DEFAULT CHARSET</span><span
                class="pun">=</span><span class="pln">utf8 ROW_FORMAT</span><span class="pun">=</span><span class="pln">DYNAMIC COMMENT</span><span
                class="pun">=</span><span class="str">'订单表'</span><span class="pun">;</span></code></li><li
                class="L0"><code></code></li><li class="L1"><code><span class="pln">SET FOREIGN_KEY_CHECKS </span><span
                class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span
                class="pun">;</span></code></li></ol></pre>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="lw8k" id="322-代码生成">3.2.2 代码生成</h4>
        <p data-anchor-id="9ae5">登录管理系统，打开代码生成页面，填写如下内容，注意看<code>红线部分</code>内容 <br>
            <img src="http://static.zybuluo.com/stylefeng/dxf3stafwgxoohun9xblyhro/image_1c4k9ladaqbksvfhtlrdb1t9jm.png"
                 alt="image_1c4k9ladaqbksvfhtlrdb1t9jm.png-90kB" title=""></p>
        <p data-anchor-id="gf81">下面详细讲解代码生成使用: <br>
            1. <strong>项目路径:</strong> 代码生成的路径，具体到guns-admin模块的绝对路径，<code>一般不需要修改</code>，因为程序会自动计算出guns-admin的绝对路径 <br>
            2. <strong>项目的包:</strong> 为guns-admin的同<code>GunsApplication</code>类同一目录的包，如下图，一般也不需要修改 <br>
            <img src="http://static.zybuluo.com/stylefeng/92mxe1909ti340jvvje157tu/image_1cpuemk8c1pi11dl41m1t47213o8m.png"
                 alt="image_1cpuemk8c1pi11dl41m1t47213o8m.png-31.8kB" title=""> <br>
            3. <strong>核心包:</strong> gun-core的包，一般也不需要修改 <br>
            4. <strong>作者:</strong> 填写代码生成出的注释上的作者 <br>
            5. <strong>业务名称:</strong> 生成业务的中午名称 <br>
            6. <strong>模块名称:</strong> 对应代码中modular包下的模块名称，如下图，若模块名称填order，则生成出的业务代码回到order包下 <br>
            <img src="http://static.zybuluo.com/stylefeng/sszpxlkhv2dp6bxaytdfke9v/image_1cpueocmfg721rcphg51dc4afr13.png"
                 alt="image_1cpueocmfg721rcphg51dc4afr13.png-35.9kB" title=""> <br>
            7. <strong>父级菜单:</strong> 此项的选择会影响生成sql添加菜单项的切入点，生成出的sql文件执行后可自动增加到sys_menu菜单项，省去手动添加菜单的繁琐 <br>
            8. <strong>表前缀:</strong> 填写此项会自动移除生成实体，mapper和service类的名称中包含的重复前缀，例如生成订单表业务代码时，填写<code>biz_</code>，则生成的实体中不会包含Biz前缀名称，若不填写，则生成的实体类为BizOrder
            <br>
            9. <strong>数据表:</strong> 选择即为生成该表所对应的实体，dao，service等类 <br>
            10. <strong>模板:</strong> 选择后生成相应的控制器，实体，service，dao代码等等</p>
        <p data-anchor-id="ncul"><strong>生成代码之后需要重启一下管理系统，生成的代码才可以生效!</strong></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="68wq" id="333-添加菜单与分配权限">3.3.3 添加菜单与分配权限</h4>
        <p data-anchor-id="r612">生成代码之后，需要为管理系统添加菜单，才可以让新增加的业务显示到页面上，添加菜单有两种方式: <br>
            <strong>第一种</strong>为手动添加菜单，依次点击<code>系统管理</code>-&gt;<code>菜单管理</code>-&gt;<code>点击添加</code>，打开添加页面，如下 <br>
            <img src="http://static.zybuluo.com/stylefeng/s04u5kop4c5dtopu2hsdlab6/image_1c4kcll604kcn1dd6u1160168b2n.png"
                 alt="image_1c4kcll604kcn1dd6u1160168b2n.png-54.2kB" title=""></p>
        <p data-anchor-id="fwct">这里需要注意如下几点:</p>
        <blockquote data-anchor-id="z94l" class="white-blockquote">
            <ul>
                <li><code>请求地址</code>需要和Controller中的RequestMapping的值一致</li>
                <li><code>排序</code>为同层级菜单中显示菜单的顺序</li>
                <li><code>父级编号</code>的选择可以更改菜单插入的位置</li>
                <li><code>图标</code>可以从H+的资源库中获取</li>
                <li>因为菜单管理不单单是对管理系统中的菜单管理，也包含权限的管理，所以需要选择是否是菜单这个选项</li>
            </ul>
        </blockquote>
        <p data-anchor-id="3ydy"><strong>第二种</strong>添加菜单的方式为直接执行代码生成中的sql脚本，默认生成的sql文件在<code>src/main/java</code>目录下，如下所示
        </p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="9pjf"><ol class="linenums"><li class="L0"><code><span
                class="pln">INSERT INTO </span><span class="str">`guns`</span><span class="pun">.</span><span
                class="str">`sys_menu`</span><span class="pln"> </span><span class="pun">(</span><span
                class="str">`id`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`code`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`pcode`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`pcodes`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`name`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`icon`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`url`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`num`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`levels`</span><span class="pun">,</span><span class="pln"> </span><span class="str">`ismenu`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`tips`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`status`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`isopen`</span><span
                class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'956388083570089986'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'0'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'[0],'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'订单管理'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">''</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'/order'</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'99'</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'1'</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'1'</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'1'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'0'</span><span class="pun">);</span></code></li><li
                class="L1"><code><span class="pln">INSERT INTO </span><span class="str">`guns`</span><span
                class="pun">.</span><span class="str">`sys_menu`</span><span class="pln"> </span><span
                class="pun">(</span><span class="str">`id`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`code`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`pcode`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`pcodes`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`name`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`icon`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`url`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`num`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`levels`</span><span class="pun">,</span><span class="pln"> </span><span class="str">`ismenu`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`tips`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`status`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`isopen`</span><span
                class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'956388083570089987'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order_list'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'[0],[order],'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'订单管理列表'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">''</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'/order/list'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'99'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'2'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'0'</span><span
                class="pun">,</span><span class="pln"> NULL</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'1'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'0'</span><span class="pun">);</span></code></li><li
                class="L2"><code><span class="pln">INSERT INTO </span><span class="str">`guns`</span><span
                class="pun">.</span><span class="str">`sys_menu`</span><span class="pln"> </span><span
                class="pun">(</span><span class="str">`id`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`code`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`pcode`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`pcodes`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`name`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`icon`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`url`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`num`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`levels`</span><span class="pun">,</span><span class="pln"> </span><span class="str">`ismenu`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`tips`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`status`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`isopen`</span><span
                class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'956388083570089988'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order_add'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'[0],[order],'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'订单管理添加'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">''</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'/order/add'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'99'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'2'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'0'</span><span
                class="pun">,</span><span class="pln"> NULL</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'1'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'0'</span><span class="pun">);</span></code></li><li
                class="L3"><code><span class="pln">INSERT INTO </span><span class="str">`guns`</span><span
                class="pun">.</span><span class="str">`sys_menu`</span><span class="pln"> </span><span
                class="pun">(</span><span class="str">`id`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`code`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`pcode`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`pcodes`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`name`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`icon`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`url`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`num`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`levels`</span><span class="pun">,</span><span class="pln"> </span><span class="str">`ismenu`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`tips`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`status`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`isopen`</span><span
                class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'956388083570089989'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order_update'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'[0],[order],'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'订单管理更新'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">''</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'/order/update'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'99'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'2'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'0'</span><span
                class="pun">,</span><span class="pln"> NULL</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'1'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'0'</span><span class="pun">);</span></code></li><li
                class="L4"><code><span class="pln">INSERT INTO </span><span class="str">`guns`</span><span
                class="pun">.</span><span class="str">`sys_menu`</span><span class="pln"> </span><span
                class="pun">(</span><span class="str">`id`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`code`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`pcode`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`pcodes`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`name`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`icon`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`url`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`num`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`levels`</span><span class="pun">,</span><span class="pln"> </span><span class="str">`ismenu`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`tips`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`status`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`isopen`</span><span
                class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'956388083570089990'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order_delete'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'[0],[order],'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'订单管理删除'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">''</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'/order/delete'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'99'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'2'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'0'</span><span
                class="pun">,</span><span class="pln"> NULL</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'1'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'0'</span><span class="pun">);</span></code></li><li
                class="L5"><code><span class="pln">INSERT INTO </span><span class="str">`guns`</span><span
                class="pun">.</span><span class="str">`sys_menu`</span><span class="pln"> </span><span
                class="pun">(</span><span class="str">`id`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`code`</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">`pcode`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`pcodes`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`name`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`icon`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`url`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`num`</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">`levels`</span><span class="pun">,</span><span class="pln"> </span><span class="str">`ismenu`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`tips`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`status`</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">`isopen`</span><span
                class="pun">)</span><span class="pln"> VALUES </span><span class="pun">(</span><span class="str">'956388083570089991'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order_detail'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'order'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'[0],[order],'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'订单管理详情'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">''</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">'/order/detail'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'99'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'2'</span><span
                class="pun">,</span><span class="pln"> </span><span class="str">'0'</span><span
                class="pun">,</span><span class="pln"> NULL</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'1'</span><span class="pun">,</span><span
                class="pln"> </span><span class="str">'0'</span><span class="pun">);</span></code></li></ol></pre>
        <p data-anchor-id="s03z">执行完成后可以看到，菜单管理页面中已经有了新添加的订单相关的菜单和资源，如下 <br>
            <img src="http://static.zybuluo.com/stylefeng/wxjxerlk8tsjve19o4egp9mq/image_1c4lpa1c41ndm3c31na83oltf79.png"
                 alt="image_1c4lpa1c41ndm3c31na83oltf79.png-284.2kB" title=""></p>
        <p data-anchor-id="fu1m"><strong>在添加完菜单只有，还需要给角色分配相关的菜单权限，才可以把新增的业务显示到菜单上</strong></p>
        <p data-anchor-id="jewj">打开<code>系统管理</code>-&gt;<code>角色管理</code>，给当前的登录的超级管理员，增加刚才新增的权限，如下图 <br>
            <img src="http://static.zybuluo.com/stylefeng/4doojtey8r4561tbqxzdt224/image_1c4lpcuabtoj1nnc1e4n7l4da1m.png"
                 alt="image_1c4lpcuabtoj1nnc1e4n7l4da1m.png-143.8kB" title=""></p>
        <p data-anchor-id="alap">配置完成刷新页面即可看到，即可看到新增加的菜单，如下图，若看不到请重新登录 <br>
            <img src="http://static.zybuluo.com/stylefeng/r3ooq3932kzrb1g466fkbtt1/image_1c4lr5pkd1634h5o7t1bcu1jh813.png"
                 alt="image_1c4lr5pkd1634h5o7t1bcu1jh813.png-22.9kB" title=""></p>
        <p data-anchor-id="pssp">到这里，基本的增删改查功能就实现了，如下图 <br>
            <img src="http://static.zybuluo.com/stylefeng/jzufu6fm4sdeu1uki5k1apt0/image_1c4lr9ort199k11vcoq91h621u8p20.png"
                 alt="image_1c4lr9ort199k11vcoq91h621u8p20.png-44.1kB" title=""> <br>
            <img src="http://static.zybuluo.com/stylefeng/b86dtsn7fhayskbjqw590tue/image_1c4lrbeu4v9va5u160oevjni22d.png"
                 alt="image_1c4lrbeu4v9va5u160oevjni22d.png-56kB" title=""></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="80lx" id="334-编写业务代码">3.3.4 编写业务代码</h4>
        <p data-anchor-id="8pq0">
            由于Guns的代码生成器还不能实现100%的智能，所以生成之后还需要对生成的代码做一些完善，如果有除了增删改查以外的业务，还需要手动编写。例如，上面编写的添加订单和修改订单里，下单时间默认是text文本框，这里需要手动改为laydate样式的日期框，如下图
            <br>
            <img src="http://static.zybuluo.com/stylefeng/thnbgj9au0rczb6a42rr8zvm/image_1c4mlgs5v46dsf1uadj3a1sna9.png"
                 alt="image_1c4mlgs5v46dsf1uadj3a1sna9.png-27.4kB" title=""></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="cima" id="33-权限控制与校验">3.3 权限控制与校验</h3>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="i5fw" id="331-用户角色和资源">3.3.1 用户，角色和资源</h4>
        <p data-anchor-id="49rk">
            用户、角色和资源（或者说权限），这三者的关系是<code>用户对应角色</code>，<code>角色对应资源</code>，菜单和所有的按钮都可以看做是<code>资源</code>(或<code>权限</code>)，把某一个角色赋予相应的资源，那么该角色就会有访问该资源的权限，否则，该角色访问这些被管控的资源就会被服务器返回<code>403
            没有权限</code>，当角色绑定资源后还需要给<code>用户赋予角色</code>才可以让登录的用户访问相关服务器接口。</p>
        <p data-anchor-id="ldd8"><strong>一句话概括: 用户对应角色，角色对应资源</strong></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="y9r6" id="332-如何对资源进行权限控制">3.3.2 如何对资源进行权限控制</h4>
        <p data-anchor-id="solt">Guns系统中，通过在控制器上加<code>@Permission</code>注解进行权限校验，如下所示，该接口在被访问的时候，就会进行权限校验</p>
        <p data-anchor-id="kegd"><img
                src="http://static.zybuluo.com/stylefeng/r2hczilx9mhcgv3eordbls6j/image_1c4mn6qsl1be51mq512v18rf1ehdm.png"
                alt="image_1c4mn6qsl1be51mq512v18rf1ehdm.png-19.5kB" title=""></p>
        <p data-anchor-id="r38r">通过我们查找<code>用户对应的角色</code>，并查找<code>角色对应的资源</code>，可以找到，当前用户(admin)有该资源的权限，如下</p>
        <p data-anchor-id="377j"><img
                src="http://static.zybuluo.com/stylefeng/8agduiq0vba9zzbmrkcp9enr/image_1c4mnc40e1k5l137o1oj99f6qou13.png"
                alt="image_1c4mnc40e1k5l137o1oj99f6qou13.png-12.1kB" title=""></p>
        <p data-anchor-id="8p0y"><code>@Permission</code>注解中可以带一个String数组类型的参数，如下，加上该参数，则接口被限制为只有某个或某些角色才可访问</p>
        <p data-anchor-id="4ms3"><img
                src="http://static.zybuluo.com/stylefeng/u8cyfp6cu1kukjdwwpmhmapp/image_1c4p772891jej148n87g1roa1ge89.png"
                alt="image_1c4p772891jej148n87g1roa1ge89.png-26.9kB" title=""></p>
        <p data-anchor-id="gz09">权限的检查是通过<code>AOP</code>拦截<code>@Permission</code>注解完成的，当访问受权限控制的资源时，<code>AOP</code>对当前请求的<code>servletPath</code>和数据库中<code>sys_menu</code>表的<code>url</code>字段进行匹配，如果当前用户所拥有的权限包含当前请求的<code>servletPath</code>，则访问这个接口成功
        </p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="imvg" id="333-前端页面对权限资源的显示">3.3.3 前端页面对权限资源的显示</h4>
        <p data-anchor-id="wrpg">在前端页面中，如果增删改查等按钮受权限控制，则我们需要对资源进行一个权限检查，如果有该资源的权限，才能让该按钮显示，通过<code>beetl</code>的<code>shiro注册方法</code>即可完成该项的检查
        </p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="gweb"><ol class="linenums"><li class="L0"><code
                class="language-html"><span class="pln">@if(shiro.hasPermission("/menu/add")){</span></code></li><li
                class="L1"><code class="language-html"><span class="pln">    &lt;#button name="添加" icon="fa-plus" clickFun="Menu.openAddMenu()"/&gt;</span></code></li><li
                class="L2"><code class="language-html"><span class="pln">@}</span></code></li><li class="L3"><code
                class="language-html"><span class="pln">@if(shiro.hasPermission("/menu/edit")){</span></code></li><li
                class="L4"><code class="language-html"><span class="pln">    &lt;#button name="修改" icon="fa-edit" clickFun="Menu.openChangeMenu()" space="true"/&gt;</span></code></li><li
                class="L5"><code class="language-html"><span class="pln">@}</span></code></li><li class="L6"><code
                class="language-html"><span class="pln">@if(shiro.hasPermission("/menu/remove")){</span></code></li><li
                class="L7"><code class="language-html"><span class="pln">    &lt;#button name="删除" icon="fa-remove" clickFun="Menu.delMenu()" space="true"/&gt;</span></code></li><li
                class="L8"><code class="language-html"><span class="pln">@}</span></code></li></ol></pre>
        <p data-anchor-id="3o2e">其中<code>shiro.hasPermission()</code>起到了权限检查的作用，如果有该资源对应的权限，则被检查的资源显示，若没有该资源的权限，则按钮不显示
        </p>
        <p data-anchor-id="m5fp"><strong>若想深入了解shiro和权限控制的实现原理，可参考视频教程第<code>12节 shiro与权限系统</code>，内有70分钟详细的讲解</strong>
        </p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="1mur" id="34-多数据源的使用">3.4 多数据源的使用</h3>
        <p data-anchor-id="00dm">首先，我们新建一个数据库<code>guns_test</code>，并分别在<code>guns</code>数据库和<code>guns_test</code>数据库中分别新增同样结构的两个表<code>test</code>，sql文件如下，也可以在<code>src/test/sql</code>下找到这个sql文件
        </p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="20uf"><ol class="linenums"><li class="L0"><code><span
                class="pln">DROP DATABASE IF EXISTS guns_test</span><span class="pun">;</span></code></li><li
                class="L1"><code><span class="pln">CREATE DATABASE IF NOT EXISTS guns_test DEFAULT CHARSET utf8 COLLATE utf8_general_ci</span><span
                class="pun">;</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="kwd">use</span><span
                class="pln"> guns_test</span><span class="pun">;</span></code></li><li class="L4"><code></code></li><li
                class="L5"><code><span class="pln">SET NAMES utf8mb4</span><span class="pun">;</span></code></li><li
                class="L6"><code><span class="pln">SET FOREIGN_KEY_CHECKS </span><span class="pun">=</span><span
                class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li
                class="L7"><code></code></li><li class="L8"><code><span class="pun">--</span><span
                class="pln"> </span><span class="pun">----------------------------</span></code></li><li
                class="L9"><code><span class="pun">--</span><span class="pln"> </span><span
                class="typ">Table</span><span class="pln"> structure </span><span class="kwd">for</span><span
                class="pln"> test</span></code></li><li class="L0"><code><span class="pun">--</span><span
                class="pln"> </span><span class="pun">----------------------------</span></code></li><li
                class="L1"><code><span class="pln">DROP TABLE IF EXISTS </span><span class="str">`test`</span><span
                class="pun">;</span></code></li><li class="L2"><code><span class="pln">CREATE TABLE </span><span
                class="str">`test`</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L3"><code><span
                class="pln">  </span><span class="str">`aaa`</span><span class="pln"> </span><span
                class="kwd">int</span><span class="pun">(</span><span class="lit">11</span><span
                class="pun">)</span><span class="pln"> NOT NULL AUTO_INCREMENT</span><span
                class="pun">,</span></code></li><li class="L4"><code><span class="pln">  </span><span
                class="str">`bbb`</span><span class="pln"> varchar</span><span class="pun">(</span><span
                class="lit">255</span><span class="pun">)</span><span class="pln"> DEFAULT NULL</span><span class="pun">,</span></code></li><li
                class="L5"><code><span class="pln">  PRIMARY KEY </span><span class="pun">(</span><span class="str">`aaa`</span><span
                class="pun">)</span><span class="pln"> USING BTREE</span></code></li><li class="L6"><code><span
                class="pun">)</span><span class="pln"> ENGINE</span><span class="pun">=</span><span
                class="typ">InnoDB</span><span class="pln"> AUTO_INCREMENT</span><span class="pun">=</span><span
                class="lit">12</span><span class="pln"> DEFAULT CHARSET</span><span class="pun">=</span><span
                class="pln">utf8 ROW_FORMAT</span><span class="pun">=</span><span class="pln">DYNAMIC</span><span
                class="pun">;</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">SET FOREIGN_KEY_CHECKS </span><span
                class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span
                class="pun">;</span></code></li></ol></pre>
        <blockquote data-anchor-id="tt0x" class="white-blockquote">
            <p>1.对表进行代码生成，方便测试两个数据源</p>
        </blockquote>
        <p data-anchor-id="v47w"><img
                src="http://static.zybuluo.com/stylefeng/qglxjt3v4k4hh080tqi69kea/image_1c4mosmth1fp4dv81ai6nbll8u1g.png"
                alt="image_1c4mosmth1fp4dv81ai6nbll8u1g.png-92.7kB" title=""></p>
        <blockquote data-anchor-id="dspa" class="white-blockquote">
            <p>2.打开application.yml中的多数据源开关</p>
        </blockquote>
        <p data-anchor-id="jbdv"><img
                src="http://static.zybuluo.com/stylefeng/egcp66ycjftwpa47mupwwzbd/image_1ci8k9e4l1kmtjmsh4a12rb10q39.png"
                alt="image_1ci8k9e4l1kmtjmsh4a12rb10q39.png-87.8kB" title=""></p>
        <blockquote data-anchor-id="2srr" class="white-blockquote">
            <p>3.配置application.yml中的多数据源的连接信息</p>
        </blockquote>
        <p data-anchor-id="k9pb"><img
                src="http://static.zybuluo.com/stylefeng/75how645k35dmuxkbma2l1u7/image_1ci8kbvun1m7b1t0g1g7r1k7u1f58m.png"
                alt="image_1ci8kbvun1m7b1t0g1g7r1k7u1f58m.png-92.2kB" title=""></p>
        <p data-anchor-id="djo7"><strong>另外注意，如果想开启多数据源，需要关闭kernel-core中mybatis-plus中的自动配置！！重要！！如下！！</strong></p>
        <p data-anchor-id="5jtn"><img
                src="http://static.zybuluo.com/stylefeng/lsvflmfx990fp950wvlgy51h/image_1cpuhger9l1722v1afo8ab1vns1g.png"
                alt="image_1cpuhger9l1722v1afo8ab1vns1g.png-81.1kB" title=""></p>
        <blockquote data-anchor-id="82et" class="white-blockquote">
            <p>4.编写测试多数据源的代码，注意观察<code>@DataSource注解</code>，这些代码都可以在<code>cn.stylefeng.guns.multi</code>包中找到</p>
        </blockquote>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="fklr"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="kwd">package</span><span class="pln"> cn</span><span
                class="pun">.</span><span class="pln">stylefeng</span><span class="pun">.</span><span
                class="pln">guns</span><span class="pun">.</span><span class="pln">multi</span><span
                class="pun">.</span><span class="pln">service</span><span class="pun">;</span></code></li><li
                class="L1"><code class="language-java"></code></li><li class="L2"><code class="language-java"><span
                class="com">/**</span></code></li><li class="L3"><code class="language-java"><span class="com"> * &lt;p&gt;</span></code></li><li
                class="L4"><code class="language-java"><span class="com"> * 服务类</span></code></li><li class="L5"><code
                class="language-java"><span class="com"> * &lt;/p&gt;</span></code></li><li class="L6"><code
                class="language-java"><span class="com"> *</span></code></li><li class="L7"><code class="language-java"><span
                class="com"> * @author fengshuonan</span></code></li><li class="L8"><code class="language-java"><span
                class="com"> * @since 2018-07-10</span></code></li><li class="L9"><code class="language-java"><span
                class="com"> */</span></code></li><li class="L0"><code class="language-java"><span
                class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
                class="pln"> </span><span class="typ">TestService</span><span class="pln"> </span><span
                class="pun">{</span></code></li><li class="L1"><code class="language-java"></code></li><li
                class="L2"><code class="language-java"><span class="pln">    </span><span class="com">/**</span></code></li><li
                class="L3"><code class="language-java"><span class="com">     * 测试多数据源的业务</span></code></li><li
                class="L4"><code class="language-java"><span class="com">     *</span></code></li><li class="L5"><code
                class="language-java"><span class="com">     * @author stylefeng</span></code></li><li class="L6"><code
                class="language-java"><span class="com">     * @Date 2017/6/23 23:02</span></code></li><li
                class="L7"><code class="language-java"><span class="com">     */</span></code></li><li class="L8"><code
                class="language-java"><span class="pln">    </span><span class="kwd">void</span><span class="pln"> testBiz</span><span
                class="pun">();</span></code></li><li class="L9"><code class="language-java"></code></li><li class="L0"><code
                class="language-java"><span class="pln">    </span><span class="com">/**</span></code></li><li
                class="L1"><code class="language-java"><span class="com">     * 测试多数据源的业务</span></code></li><li
                class="L2"><code class="language-java"><span class="com">     *</span></code></li><li class="L3"><code
                class="language-java"><span class="com">     * @author stylefeng</span></code></li><li class="L4"><code
                class="language-java"><span class="com">     * @Date 2017/6/23 23:02</span></code></li><li
                class="L5"><code class="language-java"><span class="com">     */</span></code></li><li class="L6"><code
                class="language-java"><span class="pln">    </span><span class="kwd">void</span><span class="pln"> testGuns</span><span
                class="pun">();</span></code></li><li class="L7"><code class="language-java"></code></li><li class="L8"><code
                class="language-java"><span class="pun">}</span></code></li></ol></pre>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="hzm1"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="kwd">package</span><span class="pln"> cn</span><span
                class="pun">.</span><span class="pln">stylefeng</span><span class="pun">.</span><span
                class="pln">guns</span><span class="pun">.</span><span class="pln">multi</span><span
                class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span
                class="pln">impl</span><span class="pun">;</span></code></li><li class="L1"><code
                class="language-java"></code></li><li class="L2"><code class="language-java"><span
                class="kwd">import</span><span class="pln"> cn</span><span class="pun">.</span><span class="pln">stylefeng</span><span
                class="pun">.</span><span class="pln">guns</span><span class="pun">.</span><span class="pln">core</span><span
                class="pun">.</span><span class="pln">common</span><span class="pun">.</span><span
                class="pln">constant</span><span class="pun">.</span><span class="typ">DatasourceEnum</span><span
                class="pun">;</span></code></li><li class="L3"><code class="language-java"><span
                class="kwd">import</span><span class="pln"> cn</span><span class="pun">.</span><span class="pln">stylefeng</span><span
                class="pun">.</span><span class="pln">guns</span><span class="pun">.</span><span
                class="pln">multi</span><span class="pun">.</span><span class="pln">entity</span><span
                class="pun">.</span><span class="typ">Test</span><span class="pun">;</span></code></li><li
                class="L4"><code class="language-java"><span class="kwd">import</span><span class="pln"> cn</span><span
                class="pun">.</span><span class="pln">stylefeng</span><span class="pun">.</span><span
                class="pln">guns</span><span class="pun">.</span><span class="pln">multi</span><span
                class="pun">.</span><span class="pln">mapper</span><span class="pun">.</span><span class="typ">TestMapper</span><span
                class="pun">;</span></code></li><li class="L5"><code class="language-java"><span
                class="kwd">import</span><span class="pln"> cn</span><span class="pun">.</span><span class="pln">stylefeng</span><span
                class="pun">.</span><span class="pln">guns</span><span class="pun">.</span><span
                class="pln">multi</span><span class="pun">.</span><span class="pln">service</span><span
                class="pun">.</span><span class="typ">TestService</span><span class="pun">;</span></code></li><li
                class="L6"><code class="language-java"><span class="kwd">import</span><span class="pln"> cn</span><span
                class="pun">.</span><span class="pln">stylefeng</span><span class="pun">.</span><span
                class="pln">roses</span><span class="pun">.</span><span class="pln">core</span><span
                class="pun">.</span><span class="pln">mutidatasource</span><span class="pun">.</span><span class="pln">annotion</span><span
                class="pun">.</span><span class="typ">DataSource</span><span class="pun">;</span></code></li><li
                class="L7"><code class="language-java"><span class="kwd">import</span><span class="pln"> org</span><span
                class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">beans</span><span
                class="pun">.</span><span class="pln">factory</span><span class="pun">.</span><span class="pln">annotation</span><span
                class="pun">.</span><span class="typ">Autowired</span><span class="pun">;</span></code></li><li
                class="L8"><code class="language-java"><span class="kwd">import</span><span class="pln"> org</span><span
                class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">stereotype</span><span
                class="pun">.</span><span class="typ">Service</span><span class="pun">;</span></code></li><li
                class="L9"><code class="language-java"><span class="kwd">import</span><span class="pln"> org</span><span
                class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">transaction</span><span
                class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">Transactional</span><span
                class="pun">;</span></code></li><li class="L0"><code class="language-java"></code></li><li
                class="L1"><code class="language-java"><span class="com">/**</span></code></li><li class="L2"><code
                class="language-java"><span class="com"> * &lt;p&gt;</span></code></li><li class="L3"><code
                class="language-java"><span class="com"> * 服务实现类</span></code></li><li class="L4"><code
                class="language-java"><span class="com"> * &lt;/p&gt;</span></code></li><li class="L5"><code
                class="language-java"><span class="com"> *</span></code></li><li class="L6"><code class="language-java"><span
                class="com"> * @author fengshuonan</span></code></li><li class="L7"><code class="language-java"><span
                class="com"> * @since 2018-07-10</span></code></li><li class="L8"><code class="language-java"><span
                class="com"> */</span></code></li><li class="L9"><code class="language-java"><span
                class="lit">@Service</span></code></li><li class="L0"><code class="language-java"><span class="kwd">public</span><span
                class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">TestServiceImpl</span><span
                class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">TestService</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code
                class="language-java"></code></li><li class="L2"><code class="language-java"><span
                class="pln">    </span><span class="lit">@Autowired</span></code></li><li class="L3"><code
                class="language-java"><span class="pln">    </span><span class="kwd">private</span><span
                class="pln"> </span><span class="typ">TestMapper</span><span class="pln"> testMapper</span><span
                class="pun">;</span></code></li><li class="L4"><code class="language-java"></code></li><li
                class="L5"><code class="language-java"><span class="pln">    </span><span
                class="lit">@Override</span></code></li><li class="L6"><code class="language-java"><span
                class="pln">    </span><span class="lit">@DataSource</span><span class="pun">(</span><span class="pln">name </span><span
                class="pun">=</span><span class="pln"> </span><span class="typ">DatasourceEnum</span><span
                class="pun">.</span><span class="pln">DATA_SOURCE_BIZ</span><span class="pun">)</span></code></li><li
                class="L7"><code class="language-java"><span class="pln">    </span><span
                class="lit">@Transactional</span></code></li><li class="L8"><code class="language-java"><span
                class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">void</span><span class="pln"> testBiz</span><span class="pun">()</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">        </span><span class="typ">Test</span><span class="pln"> test </span><span
                class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span
                class="pln"> </span><span class="typ">Test</span><span class="pun">();</span></code></li><li class="L0"><code
                class="language-java"><span class="pln">        test</span><span class="pun">.</span><span class="pln">setBbb</span><span
                class="pun">(</span><span class="str">"bizTest"</span><span class="pun">);</span></code></li><li
                class="L1"><code class="language-java"><span class="pln">        testMapper</span><span
                class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span
                class="pln">test</span><span class="pun">);</span></code></li><li class="L2"><code
                class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code
                class="language-java"></code></li><li class="L4"><code class="language-java"><span
                class="pln">    </span><span class="lit">@Override</span></code></li><li class="L5"><code
                class="language-java"><span class="pln">    </span><span class="lit">@DataSource</span><span
                class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span
                class="pln"> </span><span class="typ">DatasourceEnum</span><span class="pun">.</span><span class="pln">DATA_SOURCE_GUNS</span><span
                class="pun">)</span></code></li><li class="L6"><code class="language-java"><span class="pln">    </span><span
                class="lit">@Transactional</span></code></li><li class="L7"><code class="language-java"><span
                class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">void</span><span class="pln"> testGuns</span><span class="pun">()</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code
                class="language-java"><span class="pln">        </span><span class="typ">Test</span><span class="pln"> test </span><span
                class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span
                class="pln"> </span><span class="typ">Test</span><span class="pun">();</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">        test</span><span class="pun">.</span><span class="pln">setBbb</span><span
                class="pun">(</span><span class="str">"gunsTest"</span><span class="pun">);</span></code></li><li
                class="L0"><code class="language-java"><span class="pln">        testMapper</span><span
                class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span
                class="pln">test</span><span class="pun">);</span></code></li><li class="L1"><code
                class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2"><code
                class="language-java"><span class="pun">}</span></code></li></ol></pre>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="xbou"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="kwd">package</span><span class="pln"> cn</span><span
                class="pun">.</span><span class="pln">stylefeng</span><span class="pun">.</span><span
                class="pln">guns</span><span class="pun">.</span><span class="pln">multi</span><span
                class="pun">.</span><span class="pln">test</span><span class="pun">;</span></code></li><li
                class="L1"><code class="language-java"></code></li><li class="L2"><code class="language-java"><span
                class="kwd">import</span><span class="pln"> cn</span><span class="pun">.</span><span class="pln">stylefeng</span><span
                class="pun">.</span><span class="pln">guns</span><span class="pun">.</span><span class="pln">base</span><span
                class="pun">.</span><span class="typ">BaseJunit</span><span class="pun">;</span></code></li><li
                class="L3"><code class="language-java"><span class="kwd">import</span><span class="pln"> cn</span><span
                class="pun">.</span><span class="pln">stylefeng</span><span class="pun">.</span><span
                class="pln">guns</span><span class="pun">.</span><span class="pln">multi</span><span
                class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="typ">TestService</span><span
                class="pun">;</span></code></li><li class="L4"><code class="language-java"><span
                class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span
                class="pln">junit</span><span class="pun">.</span><span class="typ">Test</span><span
                class="pun">;</span></code></li><li class="L5"><code class="language-java"><span
                class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">springframework</span><span
                class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span
                class="pln">factory</span><span class="pun">.</span><span class="pln">annotation</span><span
                class="pun">.</span><span class="typ">Autowired</span><span class="pun">;</span></code></li><li
                class="L6"><code class="language-java"></code></li><li class="L7"><code class="language-java"><span
                class="com">/**</span></code></li><li class="L8"><code class="language-java"><span
                class="com"> * 业务测试</span></code></li><li class="L9"><code class="language-java"><span
                class="com"> *</span></code></li><li class="L0"><code class="language-java"><span class="com"> * @author fengshuonan</span></code></li><li
                class="L1"><code class="language-java"><span class="com"> * @date 2017-06-23 23:12</span></code></li><li
                class="L2"><code class="language-java"><span class="com"> */</span></code></li><li class="L3"><code
                class="language-java"><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">class</span><span class="pln"> </span><span class="typ">BizTest</span><span
                class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">BaseJunit</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code
                class="language-java"></code></li><li class="L5"><code class="language-java"><span
                class="pln">    </span><span class="lit">@Autowired</span></code></li><li class="L6"><code
                class="language-java"><span class="pln">    </span><span class="typ">TestService</span><span
                class="pln"> testService</span><span class="pun">;</span></code></li><li class="L7"><code
                class="language-java"></code></li><li class="L8"><code class="language-java"><span
                class="pln">    </span><span class="lit">@Test</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">    </span><span class="kwd">public</span><span
                class="pln"> </span><span class="kwd">void</span><span class="pln"> test</span><span
                class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li
                class="L0"><code class="language-java"><span class="pln">        testService</span><span
                class="pun">.</span><span class="pln">testGuns</span><span class="pun">();</span></code></li><li
                class="L1"><code class="language-java"></code></li><li class="L2"><code class="language-java"><span
                class="pln">        testService</span><span class="pun">.</span><span class="pln">testBiz</span><span
                class="pun">();</span></code></li><li class="L3"><code class="language-java"><span
                class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code class="language-java"><span
                class="pun">}</span></code></li></ol></pre>
        <blockquote data-anchor-id="2hx2" class="white-blockquote">
            <p>5.执行<code>BizTest</code>这个测试类，可以看出，两条数据同时插入了不同的数据库中的两张表中</p>
        </blockquote>
        <p data-anchor-id="avgd"><img
                src="http://static.zybuluo.com/stylefeng/jlj6vyn3jvdd7v3wtihm3d4m/image_1ci8kfj001dr91gg01l721g781l5f13.png"
                alt="image_1ci8kfj001dr91gg01l721g781l5f13.png-18.7kB" title=""></p>
        <p data-anchor-id="lhof"><img
                src="http://static.zybuluo.com/stylefeng/bqohygpq7vj4sh6379gsr2js/image_1ci8kg1fo18671fafp4q1k5e186u1g.png"
                alt="image_1ci8kg1fo18671fafp4q1k5e186u1g.png-26kB" title=""></p>
        <p data-anchor-id="3dje">多数据源的原理就是一个项目同时配置了两个<code>DataSource</code>，并把这两个<code>DataSource</code>放到<code>DynamicDataSource</code>绑定，使用AOP进行动态切换当前操作的数据源。
        </p>
        <p data-anchor-id="xmuo">
            <strong>若想深入了解多数据源的配置和原理可参考<code>MybatisPlusConfig类</code>和<code>MultiSourceExAop类</code>，也可参考视频教程第<code>7节
                多数据源配置和使用</code>，内有详细的讲解</strong></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="qnfx" id="35-如何分页">3.5 如何分页</h3>
        <p data-anchor-id="ipig">Guns的分页是通过<a href="http://baomidou.oschina.io/mybatis-plus-doc/#/page-plugin"
                                              target="_blank">mybatis-plus的分页插件</a>实现的，大体分如下两种情况</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="cnwl" id="351-简单查询的分页">3.5.1 简单查询的分页</h4>
        <p data-anchor-id="tdui">如果查询结果为单表查询，例如查询用户列表，则可以调用mybatis plus的自动生成的mapper中的<code>selectPage()</code>或者<code>selectMapsPage()</code>方法，<code>Page</code>类的构造函数中第一个参数为当前查询第几页，第二个参数为每页的记录数。
            <br>
            <img src="http://static.zybuluo.com/stylefeng/4ploutx9z1evpwu37n3olinj/image_1c4mrp2brphr1313asoset1bb155.png"
                 alt="image_1c4mrp2brphr1313asoset1bb155.png-21.4kB" title=""></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="0t1f" id="352-复杂查询的分页">3.5.2 复杂查询的分页</h4>
        <p data-anchor-id="my9j">若查询结果是关联多个表的操作，则需要用到自定义的mapper，此时的分页操作也很简单，只需要给mapper的第一个参数设置为<code>Page</code>对象即可，例如Guns中<code>LogController</code>中的查询<code>操作日志列表</code>，用的就是复杂查询的分页，我们可以看到在mybatis接口的第一个参数中，传递了<code>Page</code>对象，如下
            <br>
            <img src="http://static.zybuluo.com/stylefeng/cfp19uh7gnm0hsmla0e4vwf5/image_1c4ms4v6sg343nu1tmq1u1o10j65i.png"
                 alt="image_1c4ms4v6sg343nu1tmq1u1o10j65i.png-28.4kB" title=""> <br>
            当mybatis执行此方法的时候，会被mybatis-plus的分页插件自动拦截到，并且把分页查询的结果返回到这个<code>Page</code>对象中!</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="fkty" id="353-获取前端表格插件传值">3.5.3 获取前端表格插件传值</h4>
        <p data-anchor-id="n9pt">Guns中前端表格用的<a href="http://bootstrap-table.wenzhixin.net.cn/zh-cn/documentation/"
                                               target="_blank">Bootstrap Table</a>插件，在前端执行查询时，插件会自动往后台传递分页参数，并且默认的格式如下，
            <br>
            <img src="http://static.zybuluo.com/stylefeng/a0b60zevc67bgmlo08cuigsr/image_1c4msjlp71qb61b9bqlg9q4154i6v.png"
                 alt="image_1c4msjlp71qb61b9bqlg9q4154i6v.png-54.5kB" title=""> <br>
            <code>Bootstrap
                Table</code>会传递<code>order(升序或者降序)</code>，<code>offset(每页偏移量)</code>，<code>limit(每页条数)</code>，<code>sort(排序的字段)</code>这四个参数，与之对应，后台封装了一个通用的接受分页参数的类<code>PageFactory</code>，从而不用每次都来<code>request.getParameter()</code>这样接收参数，如下所示，
        </p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="vqbv"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">class</span><span class="pln"> </span><span class="typ">PageFactory</span><span class="pun">&lt;</span><span
                class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span
                class="pun">{</span></code></li><li class="L1"><code class="language-java"></code></li><li
                class="L2"><code class="language-java"><span class="pln">    </span><span class="kwd">public</span><span
                class="pln"> </span><span class="typ">Page</span><span class="pun">&lt;</span><span class="pln">T</span><span
                class="pun">&gt;</span><span class="pln"> defaultPage</span><span class="pun">()</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code
                class="language-java"><span class="pln">        </span><span class="typ">HttpServletRequest</span><span
                class="pln"> request </span><span class="pun">=</span><span class="pln"> </span><span class="typ">HttpKit</span><span
                class="pun">.</span><span class="pln">getRequest</span><span class="pun">();</span></code></li><li
                class="L4"><code class="language-java"><span class="pln">        </span><span
                class="kwd">int</span><span class="pln"> limit </span><span class="pun">=</span><span
                class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span
                class="pln">valueOf</span><span class="pun">(</span><span class="pln">request</span><span
                class="pun">.</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">"limit"</span><span
                class="pun">));</span><span class="pln">     </span><span class="com">//每页多少条数据</span></code></li><li
                class="L5"><code class="language-java"><span class="pln">        </span><span
                class="kwd">int</span><span class="pln"> offset </span><span class="pun">=</span><span
                class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span
                class="pln">valueOf</span><span class="pun">(</span><span class="pln">request</span><span
                class="pun">.</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">"offset"</span><span
                class="pun">));</span><span class="pln">   </span><span
                class="com">//每页的偏移量(本页当前有多少条)</span></code></li><li class="L6"><code class="language-java"><span
                class="pln">        </span><span class="typ">String</span><span class="pln"> sort </span><span
                class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">getParameter</span><span
                class="pun">(</span><span class="str">"sort"</span><span class="pun">);</span><span
                class="pln">         </span><span class="com">//排序字段名称</span></code></li><li class="L7"><code
                class="language-java"><span class="pln">        </span><span class="typ">String</span><span class="pln"> order </span><span
                class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">getParameter</span><span
                class="pun">(</span><span class="str">"order"</span><span class="pun">);</span><span
                class="pln">       </span><span class="com">//asc或desc(升序或降序)</span></code></li><li class="L8"><code
                class="language-java"><span class="pln">        </span><span class="kwd">if</span><span
                class="pln"> </span><span class="pun">(</span><span class="typ">ToolUtil</span><span
                class="pun">.</span><span class="pln">isEmpty</span><span class="pun">(</span><span
                class="pln">sort</span><span class="pun">))</span><span class="pln"> </span><span
                class="pun">{</span></code></li><li class="L9"><code class="language-java"><span
                class="pln">            </span><span class="typ">Page</span><span class="pun">&lt;</span><span
                class="pln">T</span><span class="pun">&gt;</span><span class="pln"> page </span><span
                class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span
                class="pln"> </span><span class="typ">Page</span><span class="pun">&lt;&gt;((</span><span class="pln">offset </span><span
                class="pun">/</span><span class="pln"> limit </span><span class="pun">+</span><span class="pln"> </span><span
                class="lit">1</span><span class="pun">),</span><span class="pln"> limit</span><span
                class="pun">);</span></code></li><li class="L0"><code class="language-java"><span class="pln">            page</span><span
                class="pun">.</span><span class="pln">setOpenSort</span><span class="pun">(</span><span class="kwd">false</span><span
                class="pun">);</span></code></li><li class="L1"><code class="language-java"><span
                class="pln">            </span><span class="kwd">return</span><span class="pln"> page</span><span
                class="pun">;</span></code></li><li class="L2"><code class="language-java"><span
                class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span
                class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li
                class="L3"><code class="language-java"><span class="pln">            </span><span
                class="typ">Page</span><span class="pun">&lt;</span><span class="pln">T</span><span
                class="pun">&gt;</span><span class="pln"> page </span><span class="pun">=</span><span
                class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
                class="typ">Page</span><span class="pun">&lt;&gt;((</span><span class="pln">offset </span><span
                class="pun">/</span><span class="pln"> limit </span><span class="pun">+</span><span class="pln"> </span><span
                class="lit">1</span><span class="pun">),</span><span class="pln"> limit</span><span class="pun">,</span><span
                class="pln"> sort</span><span class="pun">);</span></code></li><li class="L4"><code
                class="language-java"><span class="pln">            </span><span class="kwd">if</span><span
                class="pln"> </span><span class="pun">(</span><span class="typ">Order</span><span
                class="pun">.</span><span class="pln">ASC</span><span class="pun">.</span><span
                class="pln">getDes</span><span class="pun">().</span><span class="pln">equals</span><span
                class="pun">(</span><span class="pln">order</span><span class="pun">))</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code
                class="language-java"><span class="pln">                page</span><span class="pun">.</span><span
                class="pln">setAsc</span><span class="pun">(</span><span class="kwd">true</span><span
                class="pun">);</span></code></li><li class="L6"><code class="language-java"><span
                class="pln">            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code
                class="language-java"><span class="pln">                page</span><span class="pun">.</span><span
                class="pln">setAsc</span><span class="pun">(</span><span class="kwd">false</span><span
                class="pun">);</span></code></li><li class="L8"><code class="language-java"><span
                class="pln">            </span><span class="pun">}</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">            </span><span class="kwd">return</span><span
                class="pln"> page</span><span class="pun">;</span></code></li><li class="L0"><code
                class="language-java"><span class="pln">        </span><span class="pun">}</span></code></li><li
                class="L1"><code class="language-java"><span class="pln">    </span><span
                class="pun">}</span></code></li><li class="L2"><code class="language-java"><span
                class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="kaio">在后台代码中如需接收参数，构建分页Page对象的时候，只需如下这样一调用即可构建分页对象</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="p01u"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="typ">Page</span><span class="pun">&lt;</span><span class="typ">OperationLog</span><span
                class="pun">&gt;</span><span class="pln"> page </span><span class="pun">=</span><span
                class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
                class="typ">PageFactory</span><span class="pun">&lt;</span><span class="typ">OperationLog</span><span
                class="pun">&gt;().</span><span class="pln">defaultPage</span><span
                class="pun">();</span></code></li></ol></pre>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="e3et" id="36-数据范围">3.6 数据范围</h3>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="aeg5" id="361-介绍">3.6.1 介绍</h4>
        <p data-anchor-id="d00p">Guns的数据范围是指当前部门的用户可以看到当前部门和子部门的数据，子部门的数据不可以看到上级部门的数据，但<code>超级管理员</code>例外，例如，<code>userA</code>和<code>userB</code>两个用户都有查看用户列表的权限，但是<code>userA</code>在总公司部门，<code>userB</code>在运营部，他们有如下部门关系
        </p>
        <p data-anchor-id="twrg"><img
                src="http://static.zybuluo.com/stylefeng/rysfq22xp5dg99446qdlvs1y/image_1c4mu0mfbf48prrac1dv61t1u7s.png"
                alt="image_1c4mu0mfbf48prrac1dv61t1u7s.png-17kB" title=""></p>
        <p data-anchor-id="rn08">
            那么<code>userA</code>在查看用户列表的时候能看到<code>公司所有人</code>的数据，<code>userB</code>只能看到<code>运营部</code>的数据，这就是数据范围!
        </p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="rgsp" id="362-如何使用">3.6.2 如何使用</h4>
        <p data-anchor-id="8vzi">使用时，只需要<code>new</code>一个<code>DataScope</code>，并在构造方法中传递给当前用户用后的部门权限(一般我们用封装好的<code>ShiroKit.getDeptDataScope()</code>方法即可获取到当前用户的部门权限集合)，之后，传递给mybatis的dao方法的第一个参数即可，例子如下
        </p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="iayc"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="typ">DataScope</span><span class="pln"> dataScope </span><span
                class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span
                class="pln"> </span><span class="typ">DataScope</span><span class="pun">(</span><span class="typ">ShiroKit</span><span
                class="pun">.</span><span class="pln">getDeptDataScope</span><span class="pun">());</span></code></li><li
                class="L1"><code class="language-java"><span class="typ">List</span><span class="pun">&lt;</span><span
                class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span
                class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span
                class="pun">&gt;&gt;</span><span class="pln"> users </span><span class="pun">=</span><span class="pln"> managerDao</span><span
                class="pun">.</span><span class="pln">selectUsers</span><span class="pun">(</span><span class="pln">dataScope</span><span
                class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span
                class="pln"> beginTime</span><span class="pun">,</span><span class="pln"> endTime</span><span
                class="pun">，</span><span class="pln"> deptid</span><span class="pun">);</span></code></li></ol></pre>
        <p data-anchor-id="6wl1"><strong>注意:</strong> 在使用过程中，原mybatis的dao方法的查询结果中必须包含<code>deptid字段(默认情况)</code>，若部门id不叫deptid也可也初始化<code>DateScope</code>对象的时候，修改该对象的<code>scopeName</code>属性，改为自定义的部门id字段名即可
        </p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="9k97" id="363-原理">3.6.3 原理</h4>
        <p data-anchor-id="ly90">
            数据范围的原理是利用了<code>mybatis拦截器</code>，类似于mybatis-plus的分页插件，在原查询结果之上包装了一层<code>select筛选查询</code>，如下</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="ypkf"><ol class="linenums"><li class="L0"><code><span
                class="kwd">select</span><span class="pln"> </span><span class="pun">(原语句字段)</span><span
                class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span
                class="pun">(原语句)</span><span class="pln"> </span><span class="kwd">where</span><span class="pln"> deptid </span><span
                class="kwd">in</span><span class="pln"> </span><span class="pun">(</span><span
                class="typ">DataScope</span><span class="pun">对象中包含的部门</span><span class="pln">id</span><span
                class="pun">列表)</span></code></li></ol></pre>
        <p data-anchor-id="kn6s"><strong>若想深入了解数据范围的编写过程和原理可参考视频教程第<code>15节 数据范围使用和原理</code>，内有详细的讲解</strong></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="62c9" id="37-guns-rest模块的使用">3.7 guns-rest模块的使用</h3>
        <blockquote data-anchor-id="imu7" class="white-blockquote">
            <p>guns-rest模块已在Guns 5.1版本中剔除掉了,若想了解jwt相关的使用方法可以参考Guns 4.2版本（<a
                    href="https://gitee.com/stylefeng/guns/tree/v4.2/" target="_blank">https://gitee.com/stylefeng/guns/tree/v4.2/</a>）
            </p>
        </blockquote>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="0t25" id="371-关于jwt鉴权">3.7.1 关于jwt鉴权</h4>
        <p data-anchor-id="mjyf">在了解guns-rest模块的使用之前，需要了解一下jwt鉴权机制，下面给出一些参考资料</p>
        <blockquote data-anchor-id="rt1m" class="white-blockquote">
            <ul>
                <li>什么是JWT-JSON WEB TOKEN -&gt; <a href="https://www.jianshu.com/p/576dbf44b2ae" target="_blank">https://www.jianshu.com/p/576dbf44b2ae</a>
                </li>
            </ul>
        </blockquote>
        <p data-anchor-id="d8ea">说白了就是如果想请求服务器资源，需要先走服务器的auth接口，用账号和密码换取token，之后每个接口的请求都需要带着token去访问，否则就是鉴权失败.</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="2zdm" id="372-关于传输数据的签名">3.7.2 关于传输数据的签名</h4>
        <p data-anchor-id="8j8d">
            签名机制是指客户端向服务端传输数据中，对传输数据进行md5加密，并且加密过程中利用Auth接口返回的随机字符串进行混淆加密，并把md5值同时附带给服务端，服务端通获取数据之后对数据再进行一次md5加密，若加密结果和客户端传来的数据一致，则认定客户端请求的数据是没有被篡改的，若不一致，则认为被加密的数据是被篡改的.</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="pr4z" id="373-guns-rest模块的运行流程">3.7.3 guns-rest模块的运行流程</h4>
        <ol data-anchor-id="03pv">
            <li>执行<code>guns-rest</code>模块下的db文件夹的sql初始化脚本<code>guns_rest.sql</code></li>
            <li>启动<code>guns-rest</code>模块</li>
            <li>下载<a href="https://www.getpostman.com/" target="_blank">postman</a>接口测试工具或者<a
                    href="https://insomnia.rest/" target="_blank">insomnia接口测试工具</a>，下面以insomnia接口测试工具为例，演示rest模块资源访问流程
            </li>
            <li>访问/auth接口，传递给接口账号密码获取访问接口用的token，如下 <br>
                <img src="http://static.zybuluo.com/stylefeng/k2af2okr8vikmj99gut7ltln/image_1c4paeghfoa21mmu84jrb113l4m.png"
                     alt="image_1c4paeghfoa21mmu84jrb113l4m.png-75.2kB" title=""> <br>
                接口请求成功，auth接口返回给两个属性的json，<code>randomKey</code>的作用是在之后接口的数据传输中对数据做MD5混淆加密用的，<code>token</code>的作用是在之后访问资源的过程中，携带到请求的header中，证明我们是有权限访问资源的
            </li>
            <li>接着去访问<code>/hello</code>接口，在访问之前，我们需要做两件事： <br>
                <strong>第一</strong> 把请求hello接口的请求头Header中带一个<code>Authorization</code>属性，属性的值为<code>Bearer</code>和<code>token</code>值，注意中间用空格隔开
                <br>
                <img src="http://static.zybuluo.com/stylefeng/m96jhjyyx68idfzk2c546ygo/image_1c4pb4r481mse1dlj1tdu12lnh213.png"
                     alt="image_1c4pb4r481mse1dlj1tdu12lnh213.png-64.1kB" title=""> <br>
                <strong>第二</strong> <code>/hello</code>接口的所需要一个<code>@RequestBody</code>类型的数据，所以我们还需要传给这个接口一个json数据 <br>
                <img src="http://static.zybuluo.com/stylefeng/rhcxqvr1pstga43tk8yb407w/image_1c4pb8kd51kck1lkg4fmdls1sdo1g.png"
                     alt="image_1c4pb8kd51kck1lkg4fmdls1sdo1g.png-13.7kB" title=""> <br>
                <strong>注意</strong> json数据不能直接为如下的形式
            </li>
        </ol>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="ps11"><ol class="linenums"><li class="L0"><code><span
                class="pun">{</span><span class="str">"name"</span><span class="pun">:</span><span
                class="str">"ffff"</span><span class="pun">,</span><span class="str">"user"</span><span
                class="pun">:</span><span class="str">"stylefeng"</span><span class="pun">,</span><span class="str">"age"</span><span
                class="pun">:</span><span class="lit">12</span><span class="pun">,</span><span class="str">"tips"</span><span
                class="pun">:</span><span class="str">"code"</span><span class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="9u1z">为了保证传输的数据的安全性，Guns做了对传输数据的签名，所以传输过程中需要对数据进行签名，我们可以直接运行<code>DecryptTest</code>这个测试类，直接生成签名好的json数据，如下
            <br>
            <img src="http://static.zybuluo.com/stylefeng/xacjfkbdvxv6yzq4p40nctz0/image_1c4pbeivc1bq31vhn1f2615ji1681t.png"
                 alt="image_1c4pbeivc1bq31vhn1f2615ji1681t.png-48.6kB" title=""> <br>
            这里注意填写md5的加密盐为刚才/auth接口生成的randomKey，运行后生成如下json</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="e4tn"><ol class="linenums"><li class="L0"><code><span
                class="pun">{</span><span class="str">"object"</span><span class="pun">:</span><span class="str">"eyJhZ2UiOjEyLCJuYW1lIjoiZmZmZiIsInRpcHMiOiJjb2RlIiwidXNlciI6InN0eWxlZmVuZyJ9"</span><span
                class="pun">,</span><span class="str">"sign"</span><span class="pun">:</span><span class="str">"d737820570c0881e8614272f9792e07d"</span><span
                class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="4fhc">我们填入到接口的<code>请求体</code>里，并点击<code>Send</code> <br>
            <img src="http://static.zybuluo.com/stylefeng/fii1a6wgg7n9y78aoqntd3rs/image_1c4pbhob317vk1ck4fp61veu89h2a.png"
                 alt="image_1c4pbhob317vk1ck4fp61veu89h2a.png-56.3kB" title=""></p>
        <p data-anchor-id="tcck">接口访问成功!</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="s276" id="374-运行原理">3.7.4 运行原理</h4>
        <p data-anchor-id="tfje">关于rest模块鉴权运行原理，其实就是一个简单的过滤器<code>AuthFilter类</code>实现的，若想了解运行机制可以查看下<code>auth包</code>下的类的代码(几十行)
            <br>
            <img src="http://static.zybuluo.com/stylefeng/qtp4gvyeqhqxrsso6byxgqfr/image_1c4pbvvle1bqi85210en1ou9g442n.png"
                 alt="image_1c4pbvvle1bqi85210en1ou9g442n.png-37.5kB" title=""></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="2pw9" id="38-工作流">3.8 工作流</h3>
        <blockquote data-anchor-id="btwj" class="white-blockquote">
            <p>工作流在Guns 5.1中也剔除掉了（因为不是必需品），不过如果需要使用工作流的话可以用Guns 3.3版本（<a
                    href="https://gitee.com/stylefeng/guns/tree/v3.3" target="_blank">https://gitee.com/stylefeng/guns/tree/v3.3</a>）
            </p>
        </blockquote>
        <p data-anchor-id="aoot">Guns 3.1版本引入了工作流框架flowable
            6.2.0，并自带一个报销流程供大家参考，但是为了满足大家的需求，工作流不是绝大多数人都会使用，所以目前不对工作流提供支持，若需要项目集成工作流，可以仿照Guns3.1提供的flowable的配置，作为参考，自行集成一下工作流相关的内容，下面介绍一下之前版本的工作流。</p>
        <p data-anchor-id="gefg">为了不和guns的数据库混淆，guns新建了一个数据库<code>guns_flowable</code>，并配置了一个<code>单独的数据源</code>来连接该数据库，在application.yml中的配置如下
            <br>
            <img src="http://static.zybuluo.com/stylefeng/ze9j4m8hv0b76v180nzn9y1v/image_1c4pccdfhep7ii7p684iv1ukb34.png"
                 alt="image_1c4pccdfhep7ii7p684iv1ukb34.png-36.4kB" title=""></p>
        <p data-anchor-id="eojj">在guns启动过程中，若<code>guns_flowable</code>数据库没有表，flowable引擎会自动初始化工作流需要的表</p>
        <p data-anchor-id="nsr5">在报销管理业务中，一共有三个角色，<code>申请人</code>(账号:admin)，<code>经理</code>(账号:manager)，<code>老板</code>(账号:boss)，他们的密码都是<code>111111</code>，首先申请人填写报销单，
            <br>
            <img src="http://static.zybuluo.com/stylefeng/k7g3zm71cv2t3adxg3mh3lpt/image_1c4pcrtts1ig0cj11ade1k8d1llh3h.png"
                 alt="image_1c4pcrtts1ig0cj11ade1k8d1llh3h.png-19.3kB" title=""> <br>
            填写之后需要在<code>报销审批</code>菜单中，提交下自己的申请 <br>
            <img src="http://static.zybuluo.com/stylefeng/5kgmkotzxvgei63s0lgx7rmm/image_1c4pctk939n1tjo25g1v1n1cji3u.png"
                 alt="image_1c4pctk939n1tjo25g1v1n1cji3u.png-45.4kB" title=""> <br>
            如果报销金额小于500则是<code>经理(manager)</code>审批，我们登录经理的号，可以看到申请记录 <br>
            <img src="http://static.zybuluo.com/stylefeng/sd1bufeir4m9qnihew4og4i5/image_1c4pd00lf169q1lvg14q71rf9nof4r.png"
                 alt="image_1c4pd00lf169q1lvg14q71rf9nof4r.png-51.3kB" title=""> <br>
            这里点击<code>通过</code>，则该流程结束，如果点<code>不通过</code>则还需要申请人重新提交申请</p>
        <p data-anchor-id="gijk">关于工作流的开发，可以参考<a href="http://www.flowable.org/documentation.html" target="_blank">flowable官方文档</a>
        </p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="dzbv" id="39-日志记录">3.9 日志记录</h3>
        <p data-anchor-id="rvde">
            在我们日常开发中，对于某些关键业务，我们通常需要记录该操作的内容，例如修改了什么数据，修改的内容是什么，删除了哪些数据等等，在Guns中有一整套完善的解决方案来完成此项功能</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="ff6p" id="391-业务日志">3.9.1 业务日志</h4>
        <p data-anchor-id="0amn">我们通过<code>@BussinessLog注解</code>来记录日志，该注解源码如下，</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="89ss"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="com">/**</span></code></li><li class="L1"><code
                class="language-java"><span class="com"> * 标记需要做业务日志的方法</span></code></li><li class="L2"><code
                class="language-java"><span class="com"> *</span></code></li><li class="L3"><code class="language-java"><span
                class="com"> * @author fengshuonan</span></code></li><li class="L4"><code class="language-java"><span
                class="com"> * @date 2017-03-31 12:46</span></code></li><li class="L5"><code class="language-java"><span
                class="com"> */</span></code></li><li class="L6"><code class="language-java"><span class="lit">@Inherited</span></code></li><li
                class="L7"><code class="language-java"><span class="lit">@Retention</span><span
                class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span
                class="pun">)</span></code></li><li class="L8"><code class="language-java"><span
                class="lit">@Target</span><span class="pun">({</span><span class="typ">ElementType</span><span
                class="pun">.</span><span class="pln">METHOD</span><span class="pun">})</span></code></li><li
                class="L9"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span
                class="lit">@interface</span><span class="pln"> </span><span class="typ">BussinessLog</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code
                class="language-java"></code></li><li class="L1"><code class="language-java"><span
                class="pln">    </span><span class="com">/**</span></code></li><li class="L2"><code
                class="language-java"><span class="com">     * 业务的名称,例如:"修改菜单"</span></code></li><li class="L3"><code
                class="language-java"><span class="com">     */</span></code></li><li class="L4"><code
                class="language-java"><span class="pln">    </span><span class="typ">String</span><span class="pln"> value</span><span
                class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span
                class="pln"> </span><span class="str">""</span><span class="pun">;</span></code></li><li
                class="L5"><code class="language-java"></code></li><li class="L6"><code class="language-java"><span
                class="pln">    </span><span class="com">/**</span></code></li><li class="L7"><code
                class="language-java"><span class="com">     * 被修改的实体的唯一标识,例如:菜单实体的唯一标识为"id"</span></code></li><li
                class="L8"><code class="language-java"><span class="com">     */</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">    </span><span class="typ">String</span><span
                class="pln"> key</span><span class="pun">()</span><span class="pln"> </span><span
                class="kwd">default</span><span class="pln"> </span><span class="str">"id"</span><span
                class="pun">;</span></code></li><li class="L0"><code class="language-java"></code></li><li
                class="L1"><code class="language-java"><span class="pln">    </span><span class="com">/**</span></code></li><li
                class="L2"><code class="language-java"><span
                class="com">     * 字典(用于查找key的中文名称和字段的中文名称)</span></code></li><li class="L3"><code
                class="language-java"><span class="com">     */</span></code></li><li class="L4"><code
                class="language-java"><span class="pln">    </span><span class="typ">Class</span><span
                class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span
                class="pln"> </span><span class="typ">AbstractDictMap</span><span class="pun">&gt;</span><span
                class="pln"> dict</span><span class="pun">()</span><span class="pln"> </span><span
                class="kwd">default</span><span class="pln"> </span><span class="typ">SystemDict</span><span
                class="pun">.</span><span class="kwd">class</span><span class="pun">;</span></code></li><li
                class="L5"><code class="language-java"><span class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="kk12">其中，<code>value</code>为需要记录日志的业务名称，<code>key</code>为修改或删除内容的唯一标识，通过这个唯一标识可以知道具体的修改的哪条记录，删除的哪条记录等等，<code>dict</code>为对修改字段的中文翻译字典，因为程序记录的都是英文的字段名称，这里通过字典，把英文字段和中文名称对应起来，那么日志信息记录到数据库中就可以变为中文的记录
        </p>
        <p data-anchor-id="gwx5">以<code>UserDict</code>为例，</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="ca2x"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="com">/**</span></code></li><li class="L1"><code
                class="language-java"><span class="com"> * 用户的字典</span></code></li><li class="L2"><code
                class="language-java"><span class="com"> *</span></code></li><li class="L3"><code class="language-java"><span
                class="com"> * @author fengshuonan</span></code></li><li class="L4"><code class="language-java"><span
                class="com"> * @date 2017-05-06 15:01</span></code></li><li class="L5"><code class="language-java"><span
                class="com"> */</span></code></li><li class="L6"><code class="language-java"><span
                class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span
                class="pln"> </span><span class="typ">UserDict</span><span class="pln"> </span><span
                class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractDictMap</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code
                class="language-java"></code></li><li class="L8"><code class="language-java"><span
                class="pln">    </span><span class="lit">@Override</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">    </span><span class="kwd">public</span><span
                class="pln"> </span><span class="kwd">void</span><span class="pln"> init</span><span
                class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li
                class="L0"><code class="language-java"><span class="pln">        put</span><span
                class="pun">(</span><span class="str">"userId"</span><span class="pun">,</span><span
                class="str">"账号"</span><span class="pun">);</span></code></li><li class="L1"><code
                class="language-java"><span class="pln">        put</span><span class="pun">(</span><span class="str">"avatar"</span><span
                class="pun">,</span><span class="str">"头像"</span><span class="pun">);</span></code></li><li
                class="L2"><code class="language-java"><span class="pln">        put</span><span
                class="pun">(</span><span class="str">"account"</span><span class="pun">,</span><span
                class="str">"账号"</span><span class="pun">);</span></code></li><li class="L3"><code
                class="language-java"><span class="pln">        put</span><span class="pun">(</span><span class="str">"name"</span><span
                class="pun">,</span><span class="str">"名字"</span><span class="pun">);</span></code></li><li
                class="L4"><code class="language-java"><span class="pln">        put</span><span
                class="pun">(</span><span class="str">"birthday"</span><span class="pun">,</span><span
                class="str">"生日"</span><span class="pun">);</span></code></li><li class="L5"><code
                class="language-java"><span class="pln">        put</span><span class="pun">(</span><span class="str">"sex"</span><span
                class="pun">,</span><span class="str">"性别"</span><span class="pun">);</span></code></li><li
                class="L6"><code class="language-java"><span class="pln">        put</span><span
                class="pun">(</span><span class="str">"email"</span><span class="pun">,</span><span
                class="str">"电子邮件"</span><span class="pun">);</span></code></li><li class="L7"><code
                class="language-java"><span class="pln">        put</span><span class="pun">(</span><span class="str">"phone"</span><span
                class="pun">,</span><span class="str">"电话"</span><span class="pun">);</span></code></li><li
                class="L8"><code class="language-java"><span class="pln">        put</span><span
                class="pun">(</span><span class="str">"roleid"</span><span class="pun">,</span><span
                class="str">"角色名称"</span><span class="pun">);</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">        put</span><span class="pun">(</span><span class="str">"deptid"</span><span
                class="pun">,</span><span class="str">"部门名称"</span><span class="pun">);</span></code></li><li
                class="L0"><code class="language-java"><span class="pln">        put</span><span
                class="pun">(</span><span class="str">"roleIds"</span><span class="pun">,</span><span class="str">"角色名称集合"</span><span
                class="pun">);</span></code></li><li class="L1"><code class="language-java"><span
                class="pln">    </span><span class="pun">}</span></code></li><li class="L2"><code
                class="language-java"></code></li><li class="L3"><code class="language-java"><span
                class="pln">    </span><span class="lit">@Override</span></code></li><li class="L4"><code
                class="language-java"><span class="pln">    </span><span class="kwd">protected</span><span
                class="pln"> </span><span class="kwd">void</span><span class="pln"> initBeWrapped</span><span
                class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li
                class="L5"><code class="language-java"><span class="pln">        putFieldWrapperMethodName</span><span
                class="pun">(</span><span class="str">"sex"</span><span class="pun">,</span><span class="str">"getSexName"</span><span
                class="pun">);</span></code></li><li class="L6"><code class="language-java"><span class="pln">        putFieldWrapperMethodName</span><span
                class="pun">(</span><span class="str">"deptid"</span><span class="pun">,</span><span class="str">"getDeptName"</span><span
                class="pun">);</span></code></li><li class="L7"><code class="language-java"><span class="pln">        putFieldWrapperMethodName</span><span
                class="pun">(</span><span class="str">"roleid"</span><span class="pun">,</span><span class="str">"getSingleRoleName"</span><span
                class="pun">);</span></code></li><li class="L8"><code class="language-java"><span class="pln">        putFieldWrapperMethodName</span><span
                class="pun">(</span><span class="str">"userId"</span><span class="pun">,</span><span class="str">"getUserAccountById"</span><span
                class="pun">);</span></code></li><li class="L9"><code class="language-java"><span class="pln">        putFieldWrapperMethodName</span><span
                class="pun">(</span><span class="str">"roleIds"</span><span class="pun">,</span><span class="str">"getRoleName"</span><span
                class="pun">);</span></code></li><li class="L0"><code class="language-java"><span
                class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class="language-java"><span
                class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="f0gh">翻译字典类中包含两个方法<code>init()</code>和<code>initBeWrapped()</code>，其中<code>init()</code>为存放英文字段和中文字段的匹配，<code>initBeWrapped()</code>操作的是把某些字段的数字值翻译为中文直观名称的过程，例如当修改用户信息时，用户修改了一个人性别信息(数据库中1是男，2是女)，由1变为了2，程序记录的是数据库中1变为2，但是这句话给业务人员看到他是不知道1和2是什么东西的，所以这里做了一个<code>值的包装</code>，把<code>1</code>包装为对应的中文名称<code>男</code>，<code>2</code>包装为对应的中文名称<code>女</code>，这样，记录到数据库中，信息就变为了，xxx用户操作了<code>修改用户</code>功能，值由<code>男</code>变为了<code>女</code>.
            <br>
            在initBeWrapped()方法中<code>putFieldWrapperMethodName()</code>这个方法的第一参数是被包装的字段名，第二个参数是<code>ConstantFactory</code>中的方法名，因为默认会调用<code>ConstantFactory</code>来包装值属性
        </p>
        <p data-anchor-id="ikxh">下面介绍业务日志记录的具体步骤:</p>
        <blockquote data-anchor-id="0jpv" class="white-blockquote">
            <ul>
                <li>1.在需要被记录日志的接口上添加@BussinessLog注解，并根据需要填写三个属性(value，key，dict)</li>
                <li>2.若是添加或者修改业务，往往需要去编写Dict字典类</li>
                <li>
                    3.若是修改业务，例如修改用户信息，因为点击更新用户的时候不会提交修改之前的数据，所以在更新用户信息之前需要保存一下用户的旧的信息才可以记录用户修改的内容，这个缓存用户临时信息的地方一般添加在跳转到用户详情接口，用<code>LogObjectHolder.me().set(user);</code>这行代码来缓存用户的旧的信息，具体用法可以参考<code>UserMgrController</code>类中的<code>userEdit()</code>和<code>edit()</code>
                </li>
            </ul>
        </blockquote>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="9ka0" id="392-异常日志">3.9.2 异常日志</h4>
        <p data-anchor-id="yqh7">
            由于Guns有统一的异常拦截器，一般程序的报错，不管是业务异常还是未知的RuntimeException都会拦截并记录到数据库，若是您有自己的异常日志需要记录到数据库或者日志文件，推荐如下做法</p>
        <ol data-anchor-id="fyz0">
            <li>如果记录到数据库，调用Guns的日志记录工具类，如下</li>
        </ol>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="yh6e"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="typ">LogManager</span><span class="pun">.</span><span
                class="pln">me</span><span class="pun">().</span><span class="pln">executeLog</span><span class="pun">();</span></code></li></ol></pre>
        <p data-anchor-id="u74q">该方法为异步记录日志的方法，executeLog()方法中需要传递一个<code>TimerTask</code>对象，TimerTask对象可以用<code>LogTaskFactory</code>类创建，在<code>LogTaskFactory</code>类中，有5个方法，可以分别记录不用的日志，有<code>登录日志</code>，<code>退出日志</code>，<code>业务日志</code>，<code>异常日志</code>等等，可以自行选择调用
            <br>
            2. 若需要记录日志到文件中，可以采用slf4j的<code>org.slf4j.Logger</code>类记录，具体方法如下</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="akxi"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="com">//首先在类中初始化</span></code></li><li class="L1"><code
                class="language-java"><span class="kwd">private</span><span class="pln"> </span><span
                class="typ">Logger</span><span class="pln"> log </span><span class="pun">=</span><span
                class="pln"> </span><span class="typ">LoggerFactory</span><span class="pun">.</span><span class="pln">getLogger</span><span
                class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span
                class="pln">getClass</span><span class="pun">());</span></code></li><li class="L2"><code
                class="language-java"></code></li><li class="L3"><code class="language-java"><span
                class="com">//再在方法中调用</span></code></li><li class="L4"><code class="language-java"><span
                class="pln">log</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span
                class="str">"业务异常:"</span><span class="pun">,</span><span class="pln"> e</span><span
                class="pun">);</span></code></li></ol></pre>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="qu1x" id="310-如何使用缓存">3.10 如何使用缓存</h3>
        <p data-anchor-id="ctcu">
            在Guns中使用缓存的地方不多，主要在ConstantFactory的查询中用了缓存，在ConstantFactory有高频调用的查询，所以在这些方法上加了缓存，搜索加上缓存后还要注意在修改了相关数据的时候要删除缓存，否则可能导致数据的不一致，在Guns中默认用的是Ehcache缓存，并配合了spring
            cache使用，用spring cache的好处就是，spring cache是缓存的抽象，如果想换为redis缓存，则不用修改代码，改一下配置即可实现，下面介绍两种操作缓存的方法</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="m2lx" id="3101-用工具类操作">3.10.1 用工具类操作</h4>
        <p data-anchor-id="wfj9">在guns-core中封装了一些常用的操作Ehcache缓存的工具类<code>CacheUtil</code>，此类采用静态方法调用的方式，可以添加，获取，删除缓存，用法非常简单
        </p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="ueq1"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="com">//添加缓存，第一个参数为缓存的名称，是ehcache.xml中&lt;cache&gt;节点的NAME，key为添加缓存的键值，value为缓存的值</span></code></li><li
                class="L1"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span
                class="pln"> put</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> cacheName</span><span
                class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span
                class="pln"> key</span><span class="pun">,</span><span class="pln"> </span><span
                class="typ">Object</span><span class="pln"> value</span><span class="pun">);</span></code></li><li
                class="L2"><code class="language-java"></code></li><li class="L3"><code class="language-java"><span
                class="com">//获取某个缓存名称中的某个键值对应的缓存</span></code></li><li class="L4"><code class="language-java"><span
                class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span
                class="pln"> </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span
                class="pln"> T get</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> cacheName</span><span
                class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span
                class="pln"> key</span><span class="pun">);</span></code></li><li class="L5"><code
                class="language-java"></code></li><li class="L6"><code class="language-java"><span class="com">//获取某个缓存的所有key</span></code></li><li
                class="L7"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">static</span><span class="pln"> </span><span class="typ">List</span><span class="pln"> getKeys</span><span
                class="pun">(</span><span class="typ">String</span><span class="pln"> cacheName</span><span class="pun">);</span></code></li><li
                class="L8"><code class="language-java"></code></li><li class="L9"><code class="language-java"><span
                class="com">//删除某个key对应的缓存</span></code></li><li class="L0"><code class="language-java"><span
                class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span
                class="pln"> </span><span class="kwd">void</span><span class="pln"> remove</span><span
                class="pun">(</span><span class="typ">String</span><span class="pln"> cacheName</span><span class="pun">,</span><span
                class="pln"> </span><span class="typ">Object</span><span class="pln"> key</span><span
                class="pun">);</span></code></li><li class="L1"><code class="language-java"></code></li><li
                class="L2"><code class="language-java"><span class="com">//删除某个缓存名称下的所有缓存</span></code></li><li
                class="L3"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removeAll</span><span
                class="pun">(</span><span class="typ">String</span><span class="pln"> cacheName</span><span class="pun">);</span></code></li></ol></pre>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="pc20" id="3102-用spring-cache操作缓存">3.10.2 用spring cache操作缓存</h4>
        <p data-anchor-id="xfpp">利用spring cache来操作缓存，可以很方便的在redis和ehcache之间切换缓存实现，利用spring cache
            的缓存注解，加到方法之上可以很方便的缓存方法的结果，如果参数对应的键值存在了缓存，则下一次走这个方法则会直接返回缓存的结果，spring cache提供了4个注解来操作缓存.</p>
        <blockquote data-anchor-id="ee6v" class="white-blockquote">
            <ul>
                <li>
                    1.@Cacheable表明在调用方法之前，首先应该在缓存中查找方法的返回值，如果这个值能够找到，则会返回缓存的值，否则执行该方法，并将返回值放到缓存中，一般在数据库查询(<code>select</code>)之后调用这个注解
                </li>
                <li>2.@CachePut表明在方法调用前不会检查缓存，方法始终都会被调用，调用之后把结果放到缓存中，一般在数据库操作插入数据(<code>save</code>)的时候调用</li>
                <li>3.@CacheEvict表明spring会清除一个或者多个缓存，一般在数据库更新或者删除数据的时候调用(<code>update</code>或者<code>delete</code>)</li>
                <li>4.@Caching分组的注解，可以同时应用多个其他缓存注解，可以相同类型或者不同类型</li>
            </ul>
        </blockquote>
        <p data-anchor-id="9slp">一般在用这些注解的时候，我们需要填写两个参数，一个是<code>value</code>代表缓存的名称，一个是<code>key</code>代表缓存的键值 <br>
            <img src="http://static.zybuluo.com/stylefeng/071relxdlxsuz7jggt1ohn8z/image_1c4rro76j1s151juv1l2g16ft1mcc9.png"
                 alt="image_1c4rro76j1s151juv1l2g16ft1mcc9.png-32.8kB" title=""> <br>
            如上图所示，键值<code>key</code>一般包含两部分组成，一部分是<code>键的标识</code>例如上图中的<code>CacheKey.SINGLE_ROLE_NAME</code>，一部分是<code>参数</code>(一般是参数的值)例如上图中的<code>#roleId</code>
        </p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="r6f4" id="311-使用枚举">3.11 使用枚举</h3>
        <p data-anchor-id="05p5">在Guns中，枚举一般分两类，一种是状态枚举，一种是异常枚举，<code>状态枚举</code>的作用是枚举状态，列出状态的所有值，例如</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="y9h3"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="com">/**</span></code></li><li class="L1"><code
                class="language-java"><span class="com"> * 菜单的状态</span></code></li><li class="L2"><code
                class="language-java"><span class="com"> *</span></code></li><li class="L3"><code class="language-java"><span
                class="com"> * @author fengshuonan</span></code></li><li class="L4"><code class="language-java"><span
                class="com"> * @Date 2017年1月22日 下午12:14:59</span></code></li><li class="L5"><code class="language-java"><span
                class="com"> */</span></code></li><li class="L6"><code class="language-java"><span
                class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span
                class="pln"> </span><span class="typ">MenuStatus</span><span class="pln"> </span><span
                class="pun">{</span></code></li><li class="L7"><code class="language-java"></code></li><li
                class="L8"><code class="language-java"><span class="pln">    ENABLE</span><span
                class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">"启用"</span><span class="pun">),</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">    DISABLE</span><span class="pun">(</span><span
                class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">"禁用"</span><span class="pun">);</span></code></li><li class="L0"><code
                class="language-java"></code></li><li class="L1"><code class="language-java"><span
                class="pln">    </span><span class="kwd">int</span><span class="pln"> code</span><span
                class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span
                class="typ">String</span><span class="pln"> message</span><span class="pun">;</span></code></li><li
                class="L3"><code class="language-java"></code></li><li class="L4"><code class="language-java"><span
                class="pln">    </span><span class="typ">MenuStatus</span><span class="pun">(</span><span class="kwd">int</span><span
                class="pln"> code</span><span class="pun">,</span><span class="pln"> </span><span
                class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code
                class="language-java"><span class="pln">        </span><span class="kwd">this</span><span
                class="pun">.</span><span class="pln">code </span><span class="pun">=</span><span
                class="pln"> code</span><span class="pun">;</span></code></li><li class="L6"><code
                class="language-java"><span class="pln">        </span><span class="kwd">this</span><span
                class="pun">.</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> message</span><span
                class="pun">;</span></code></li><li class="L7"><code class="language-java"><span class="pln">    </span><span
                class="pun">}</span></code></li><li class="L8"><code class="language-java"></code></li><li
                class="L9"><code class="language-java"><span class="pln">    </span><span class="pun">...</span></code></li><li
                class="L0"><code class="language-java"><span class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="qwgp"><code>异常枚举</code>的作用是枚举所有出现的业务异常，例如，</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="1qsq"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="com">/**</span></code></li><li class="L1"><code
                class="language-java"><span class="com"> * 所有业务异常的枚举</span></code></li><li class="L2"><code
                class="language-java"><span class="com"> * </span></code></li><li class="L3"><code
                class="language-java"><span class="com"> * @author fengshuonan</span></code></li><li class="L4"><code
                class="language-java"><span class="com"> * @date 2016年11月12日 下午5:04:51</span></code></li><li class="L5"><code
                class="language-java"><span class="com"> */</span></code></li><li class="L6"><code
                class="language-java"><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">enum</span><span class="pln"> </span><span class="typ">BizExceptionEnum</span><span
                class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ServiceExceptionEnum</span><span
                class="pun">{</span></code></li><li class="L7"><code class="language-java"></code></li><li
                class="L8"><code class="language-java"><span class="pln">    </span><span class="com">/**</span></code></li><li
                class="L9"><code class="language-java"><span class="com">     * 错误的请求</span></code></li><li
                class="L0"><code class="language-java"><span class="com">     */</span></code></li><li class="L1"><code
                class="language-java"><span class="pln">    SESSION_TIMEOUT</span><span class="pun">(</span><span
                class="lit">400</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">"会话超时"</span><span class="pun">),</span></code></li><li class="L2"><code
                class="language-java"><span class="pln">    SERVER_ERROR</span><span class="pun">(</span><span
                class="lit">500</span><span class="pun">,</span><span class="pln"> </span><span
                class="str">"服务器异常"</span><span class="pun">);</span></code></li><li class="L3"><code
                class="language-java"></code></li><li class="L4"><code class="language-java"><span
                class="pln">    </span><span class="typ">BizExceptionEnum</span><span class="pun">(</span><span
                class="kwd">int</span><span class="pln"> code</span><span class="pun">,</span><span class="pln"> </span><span
                class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code
                class="language-java"><span class="pln">        </span><span class="kwd">this</span><span
                class="pun">.</span><span class="pln">code </span><span class="pun">=</span><span
                class="pln"> code</span><span class="pun">;</span></code></li><li class="L6"><code
                class="language-java"><span class="pln">        </span><span class="kwd">this</span><span
                class="pun">.</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> message</span><span
                class="pun">;</span></code></li><li class="L7"><code class="language-java"><span class="pln">    </span><span
                class="pun">}</span></code></li><li class="L8"><code class="language-java"></code></li><li
                class="L9"><code class="language-java"><span class="pln">    </span><span
                class="kwd">private</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> code</span><span
                class="pun">;</span></code></li><li class="L0"><code class="language-java"></code></li><li
                class="L1"><code class="language-java"><span class="pln">    </span><span
                class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span
                class="pun">;</span></code></li><li class="L2"><code class="language-java"></code></li><li
                class="L3"><code class="language-java"><span class="pln">    </span><span class="pun">...</span></code></li><li
                class="L4"><code class="language-java"><span class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="xaly">使用枚举可以方便维护一些状态的值和管理所有的业务异常，所以在有<code>状态</code>或者新的<code>业务异常</code>的时候推荐写到枚举里</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="92ay" id="312-spring-boot热部署">3.12 spring boot热部署</h3>
        <p data-anchor-id="ttqv"><strong>热部署的两种情况(适用于main方法启动)</strong></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="c60l" id="3121-重新加载html">3.12.1 重新加载html</h4>
        <p data-anchor-id="4j49">如果是eclipse修改html保存后可以自动替换，如果不能请检查server配置 <br>
            <img src="http://static.zybuluo.com/stylefeng/swlvewz66w6jqfoiq0vvgb9q/image_1c4tvurdb1hhnvum1a3rs3i1se362.png"
                 alt="image_1c4tvurdb1hhnvum1a3rs3i1se362.png-867.5kB" title=""></p>
        <p data-anchor-id="2tka">如果是IDEA，可以修改html之后点击这个按钮，或者按快捷键CTRL+F9，即可更新 <br>
            <img src="http://static.zybuluo.com/stylefeng/y4itthg3ppk9rs51ih9diqwz/image_1c4tvvn0jdcv15et1odl1qbd17qs6f.png"
                 alt="image_1c4tvvn0jdcv15et1odl1qbd17qs6f.png-10.3kB" title=""></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="yr99" id="3122-重新加载java类">3.12.2 重新加载java类</h4>
        <p data-anchor-id="fwzx">如果是eclipse，在application.yml中找到配置spring.devtools.restart.enabled改为true即可</p>
        <p data-anchor-id="cvnk">如果是在IDEA中: <br>
            <strong>第一步</strong> 请先修改spring.devtools.restart.enabled=true </p>
        <p data-anchor-id="l331"><strong>第二步</strong> 如下idea配置，打上对勾 <br>
            <img src="https://git.oschina.net/uploads/images/2017/0908/131027_51909aa5_551203.png" alt="输入图片说明"
                 title="屏幕截图.png"></p>
        <p data-anchor-id="davs"><strong>第三步</strong> 按下 Shift+Ctrl+Alt+/，选择Registry <br>
            <img src="https://git.oschina.net/uploads/images/2017/0908/131144_b8caa215_551203.png" alt="输入图片说明"
                 title="屏幕截图.png"></p>
        <p data-anchor-id="cnt0">进去之后，找到如下图所示的选项，打勾 <br>
            <img src="https://git.oschina.net/uploads/images/2017/0908/131215_8e5d8ecb_551203.png" alt="输入图片说明"
                 title="屏幕截图.png"></p>
        <hr>
        <div class="md-section-divider"></div>
        <h2 data-anchor-id="wct7" id="4-扩展与高级配置">4. 扩展与高级配置</h2>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="m05t" id="41-修改项目名和包名">4.1 修改项目名和包名</h3>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="ech2" id="411-修改项目名">4.1.1 修改项目名</h4>
        <ol data-anchor-id="fuju">
            <li>以guns-admin在idea环境下为例，右击项目，点<code>refactor-&gt;Rename</code> <br>
                <img src="http://static.zybuluo.com/stylefeng/ybdvculf5c6kp4yiteptatd2/image_1cpvo0tm512bd1s343pkjr1do8p.png"
                     alt="image_1cpvo0tm512bd1s343pkjr1do8p.png-136kB" title=""></li>
            <li>修改模块名称 <br>
                <img src="http://static.zybuluo.com/stylefeng/r4qin0pkia8swac1jrmbgpp2/image_1cpvo27dj4bg8i0f2c1egjv9e16.png"
                     alt="image_1cpvo27dj4bg8i0f2c1egjv9e16.png-21.1kB" title=""></li>
            <li>修改<code>pom</code>的artifactId改为<code>myguns</code> <br>
                <img src="http://static.zybuluo.com/stylefeng/oyrbf4s51kp8snq82dlnnbs6/image_1cpvo4r1fredrtu5ep1lvr1f291j.png"
                     alt="image_1cpvo4r1fredrtu5ep1lvr1f291j.png-214kB" title=""></li>
        </ol>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="obbk" id="412-修改包名">4.1.2 修改包名</h4>
        <p data-anchor-id="6jj9">下面以把<code>cn.stylefeng.guns</code>改为<code>com.company.project</code>为例</p>
        <ol data-anchor-id="3cx9">
            <li>选择<code>cn.stylefeng.guns</code>包，仍然为右键<code>refactor-&gt;Rename</code></li>
            <li>弹出对话框选择，<code>Rename all</code>，输入<code>project</code> <br>
                <img src="http://static.zybuluo.com/stylefeng/f5mahn3jio2d5xcn5f6xl0uo/image_1cpvqs2v11i6l1niafbqsk4k229.png"
                     alt="image_1cpvqs2v11i6l1niafbqsk4k229.png-36.5kB" title=""></li>
            <li>修改包名称，再次选择<code>cn.stylefeng.project</code>包，右键<code>refactor-&gt;Rename</code>，输入 <br>
                <img src="http://static.zybuluo.com/stylefeng/ym2wcmv7jmb7bw2g7ikrkwmv/image_1cpvr78g920t168214s41qpuc9o2m.png"
                     alt="image_1cpvr78g920t168214s41qpuc9o2m.png-72.6kB" title=""></li>
            <li>改完后项目可能有些类报错，进去把这些类没用的import删掉就好， <br>
                <img src="http://static.zybuluo.com/stylefeng/59z0d8uhd4nri4oplguuhg70/image_1cpvrlf841nomnpi5qalvtou4t.png"
                     alt="image_1cpvrlf841nomnpi5qalvtou4t.png-300.6kB" title=""></li>
            <li>修改application.yml中的的相关包配置 <br>
                <img src="http://static.zybuluo.com/stylefeng/ckdvao3viu1hzhljn9ire65y/image_1cpvrv8ah1p26162jp3m1no91bfep.png"
                     alt="image_1cpvrv8ah1p26162jp3m1no91bfep.png-60.4kB" title=""></li>
            <li>修改logback-spring.xml配置文件中的相关配置 <br>
                <img src="http://static.zybuluo.com/stylefeng/sprhvm0fxjkdakv7wpds4v9l/image_1cpvs23bc1d321jcgaveb6i1eii16.png"
                     alt="image_1cpvs23bc1d321jcgaveb6i1eii16.png-246.9kB" title=""></li>
            <li>修改mapper扫描相关的包配置，多数据源的也要修改 <br>
                <img src="http://static.zybuluo.com/stylefeng/s4yahku90pzxqnvvpsnkj2nl/image_1cpvsbpbb12ij11unjjfubv11643.png"
                     alt="image_1cpvsbpbb12ij11unjjfubv11643.png-133kB" title=""></li>
            <li>修改SessionHolderInterceptor类的扫描配置 <br>
                <img src="http://static.zybuluo.com/stylefeng/5pwuzx19p3ymhh6fwl18y2nz/image_1cpvst7jrm4iv411nebdv81clk60.png"
                     alt="image_1cpvst7jrm4iv411nebdv81clk60.png-147.8kB" title=""></li>
            <li>修改WebConfig中的相关配置 <br>
                <img src="http://static.zybuluo.com/stylefeng/k4a74yjdlur2ip0aise380aw/image_1cpvsugi11jt91l5bn4qpor3s26d.png"
                     alt="image_1cpvsugi11jt91l5bn4qpor3s26d.png-227.4kB" title=""></li>
            <li>另外，检查aop相关的包扫描，默认可能ide已经帮你改掉了，如果没改得自己改下 <br>
                <img src="http://static.zybuluo.com/stylefeng/obsqnw1niplgy11zhvkrhcu7/image_1cpvsvr0f1t8516152n125h9t66q.png"
                     alt="image_1cpvsvr0f1t8516152n125h9t66q.png-250.2kB" title=""></li>
        </ol>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="quwj" id="42-放过接口权限验证">4.2 放过接口权限验证</h3>
        <p data-anchor-id="ondd">在日常开发中，我们可能需要放过某个接口的权限验证，即用户不用登录就可以访问接口 <br>
            1. 首先我们在BlackboardController这个类中，增加一个接口 <br>
            <img src="http://static.zybuluo.com/stylefeng/mzagnn5yp3ugl0jbgqacm2c3/image_1c4rvmgpthklkvn1ccd1rte20a9i.png"
                 alt="image_1c4rvmgpthklkvn1ccd1rte20a9i.png-58.1kB" title=""> <br>
            2. 在<code>ShiroConfig</code>类中，找到<code>shiroFilter()</code>这个方法，配置上这个接口，注意加到最上面，这个Map是有顺序的，可以用通配符 <br>
            <img src="http://static.zybuluo.com/stylefeng/9m7n7toekf7xv2tisfsdf05c/image_1c4rvpe7r14d1a2co2l5q11njeaf.png"
                 alt="image_1c4rvpe7r14d1a2co2l5q11njeaf.png-46.7kB" title=""> <br>
            3. 启动应用，并且不登录系统，我们访问<code>http://localhost:8080/blackboard/test</code>即可看到，这个接口不需要登录也可以访问到</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="9p14" id="43-静态资源和模板位置的变更">4.3 静态资源和模板位置的变更</h3>
        <p data-anchor-id="i3ma">由于spring boot默认是把静态资源文件css，js等放到<code>resources/static</code>目录的，默认把前端模板文件放到<code>resources/templates</code>目录，笔者认为前端面页面还是按maven的思想放到<code>webapp</code>目录比较分层清晰，所以做了一个变动，主要变动如下:
        </p>
        <p data-anchor-id="v06g">yml配置中增加了两个配置 <br>
            <img src="http://static.zybuluo.com/stylefeng/ijxbpn7t9jan3epxz8slgpec/image_1c4s06qo61f5915c6nf9ea1ue3bp.png"
                 alt="image_1c4s06qo61f5915c6nf9ea1ue3bp.png-19kB" title=""></p>
        <p data-anchor-id="qwx4">若想变动资源和模板的位置修改这两个配置即可</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="68do" id="44-三个或更多数据源如何配置">4.4 三个或更多数据源如何配置</h3>
        <ol data-anchor-id="2g2f">
            <li>新建类似于<code>MutiDataSourceProperties</code>这样的类，用于接收第三个数据源 <br>
                <img src="http://static.zybuluo.com/stylefeng/ws4hqjvdgk5mdwcpr90klo6o/image_1c4s0esme1qeecs91mpg18pq10d7c6.png"
                     alt="image_1c4s0esme1qeecs91mpg18pq10d7c6.png-77.3kB" title=""></li>
            <li>在<code>MybatisPlusConfig</code>类中，配置类似于如下代码的方法 <br>
                <img src="http://static.zybuluo.com/stylefeng/xqcm8pjxmmzj4e3kvtjt3ox3/image_1c4s0h0kqtkc199i3k7lbl1ei4cj.png"
                     alt="image_1c4s0h0kqtkc199i3k7lbl1ei4cj.png-16.7kB" title=""></li>
            <li>在<code>DynamicDataSource</code>配置中，增加第二步新加的数据源 <br>
                <img src="http://static.zybuluo.com/stylefeng/au3ih8gdeczhs7ogwsybjk97/image_1c4s0k7eg1rbf1lonfd1m9eajd0.png"
                     alt="image_1c4s0k7eg1rbf1lonfd1m9eajd0.png-65kB" title=""></li>
            <li>同时在<code>DatasourceEnum</code>类中，增加第三个数据源名称 <br>
                <img src="http://static.zybuluo.com/stylefeng/mkz2b5bapi12k2sjj6i03zxo/image_1c4s0kp51177e3d2km9130uvtadd.png"
                     alt="image_1c4s0kp51177e3d2km9130uvtadd.png-24.7kB" title=""></li>
            <li>使用方法同第二个数据源使用方法相同</li>
        </ol>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="dlhn" id="45-添加登录验证码">4.5 添加登录验证码</h3>
        <p data-anchor-id="hg1f">Guns系统中内置了登录输入验证码的功能，因为开发方便调试，所以默认是关闭的，若需要开启该功能，只需要在application.yml中配置开启即可，如下 <br>
            <img src="http://static.zybuluo.com/stylefeng/y9ac5itc3tl4delbgjvhfb4x/image_1c4rvvsugsdq1gut1dhv1fnj1tnqbc.png"
                 alt="image_1c4rvvsugsdq1gut1dhv1fnj1tnqbc.png-25.8kB" title=""></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="7grv" id="46-spring-profile">4.6 spring profile</h3>
        <p data-anchor-id="lswk">
            在实际的生产环境中，往往存在多个环境，例如开发环境(dev)，测试环境(test)，生产环境(prod)，并且不同环境的数据库和日志记录等配置的都不相同，为了每次发布不同环境的包时，不来回的修改这些配置，特引入了spring
            profile，引入之后，我们只需要把所有环境的配置都预先列出来，在每次发布不同环境的包的时候，只需要选择当前激活的是哪个环境的配置即可快速切换配置，关于spring profile的详细描述可参考这篇博文<a
                href="https://www.jianshu.com/p/948c303b2253" target="_blank">https://www.jianshu.com/p/948c303b2253</a>
        </p>
        <p data-anchor-id="adje">在yml配置中，我们用<code>---</code>来切分不同profile的配置，如下 <br>
            <img src="http://static.zybuluo.com/stylefeng/hgb0na1xo4qa6qob8sktvc4b/image_1c4s14cdf16g8uq017v05181h9bfa.png"
                 alt="image_1c4s14cdf16g8uq017v05181h9bfa.png-29kB" title=""></p>
        <p data-anchor-id="xeg7">在分割线的下边我们就可以配置不同环境的配置了，<code>profile</code>可以配置多个，只需要用<code>spring.profiles</code>来标记当前节段的<code>profile</code>的名字即可
            <br>
            <img src="http://static.zybuluo.com/stylefeng/7bgnoqk4fx5u6zp1gycly8g2/image_1c4s1asg31vkknd21jd51momo06fn.png"
                 alt="image_1c4s1asg31vkknd21jd51momo06fn.png-20.5kB" title=""></p>
        <p data-anchor-id="jwlx">并用<code>spring.profiles.active</code>来激活当前的<code>profile</code>配置即可 <br>
            <img src="http://static.zybuluo.com/stylefeng/ex171hu2rg3mf0qrg36ianw6/image_1c4s1efat1odh1j393t310i6q6fg4.png"
                 alt="image_1c4s1efat1odh1j393t310i6q6fg4.png-36.9kB" title=""></p>
        <p data-anchor-id="32hi"><code>---</code>把配置切分成了多个节段，其中第一节是所有profile共有的配置，例如guns的配置中的这一大段 <br>
            <img src="http://static.zybuluo.com/stylefeng/wwn7h2naa1tl9q4fg9hnuhqj/image_1c4s1grk5r3s1j1f1ujn19tr1ftggh.png"
                 alt="image_1c4s1grk5r3s1j1f1ujn19tr1ftggh.png-165.9kB" title=""></p>
        <p data-anchor-id="if7a">第一节段<code>---</code>下方的配置则是不同的profile的配置</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="mvpl" id="47-多机器部署开启spring-session">4.7 多机器部署开启spring session</h3>
        <p data-anchor-id="vhl6">多机环境把session托管给redis存储，所以要部署和配置redis，另外需要注意的是开启相关配置 <br>
            1.单机环境下不需要依赖spring-session，所以需要把相关依赖的注释打开</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="x410"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="pun">&lt;</span><span class="pln">dependency</span><span class="pun">&gt;</span></code></li><li
                class="L1"><code class="language-java"><span class="pln">    </span><span class="pun">&lt;</span><span
                class="pln">groupId</span><span class="pun">&gt;</span><span class="pln">org</span><span
                class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">session</span><span
                class="pun">&lt;/</span><span class="pln">groupId</span><span class="pun">&gt;</span></code></li><li
                class="L2"><code class="language-java"><span class="pln">    </span><span class="pun">&lt;</span><span
                class="pln">artifactId</span><span class="pun">&gt;</span><span class="pln">spring</span><span
                class="pun">-</span><span class="pln">session</span><span class="pun">-</span><span
                class="pln">data</span><span class="pun">-</span><span class="pln">redis</span><span
                class="pun">&lt;/</span><span class="pln">artifactId</span><span class="pun">&gt;</span></code></li><li
                class="L3"><code class="language-java"><span class="pun">&lt;/</span><span class="pln">dependency</span><span
                class="pun">&gt;</span></code></li><li class="L4"><code class="language-java"><span
                class="pun">&lt;</span><span class="pln">dependency</span><span class="pun">&gt;</span></code></li><li
                class="L5"><code class="language-java"><span class="pln">    </span><span class="pun">&lt;</span><span
                class="pln">groupId</span><span class="pun">&gt;</span><span class="pln">org</span><span
                class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">boot</span><span
                class="pun">&lt;/</span><span class="pln">groupId</span><span class="pun">&gt;</span></code></li><li
                class="L6"><code class="language-java"><span class="pln">    </span><span class="pun">&lt;</span><span
                class="pln">artifactId</span><span class="pun">&gt;</span><span class="pln">spring</span><span
                class="pun">-</span><span class="pln">boot</span><span class="pun">-</span><span
                class="pln">starter</span><span class="pun">-</span><span class="pln">data</span><span
                class="pun">-</span><span class="pln">redis</span><span class="pun">&lt;/</span><span class="pln">artifactId</span><span
                class="pun">&gt;</span></code></li><li class="L7"><code class="language-java"><span
                class="pun">&lt;/</span><span class="pln">dependency</span><span
                class="pun">&gt;</span></code></li></ol></pre>
        <p data-anchor-id="otrf">2.修改application.yml中guns.spring-session-open配置，改为true，打开spring-session</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="a02k"><ol class="linenums"><li class="L0"><code><span
                class="pln">guns</span><span class="pun">.</span><span class="pln">spring</span><span
                class="pun">-</span><span class="pln">session</span><span class="pun">-</span><span
                class="pln">open</span><span class="pun">=</span><span class="kwd">true</span></code></li></ol></pre>
        <p data-anchor-id="t1uk">3.配置application.yml中，spring.redis.host，spring.redis.port，spring.redis.password</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="vwys"><ol class="linenums"><li class="L0"><code><span
                class="pln">spring</span><span class="pun">.</span><span class="pln">redis</span><span
                class="pun">.</span><span class="pln">host</span><span class="pun">=</span><span class="pln">xxx</span></code></li><li
                class="L1"><code><span class="pln">spring</span><span class="pun">.</span><span class="pln">redis</span><span
                class="pun">.</span><span class="pln">port</span><span class="pun">=</span><span class="pln">xxx</span></code></li><li
                class="L2"><code><span class="pln">spring</span><span class="pun">.</span><span class="pln">redis</span><span
                class="pun">.</span><span class="pln">password</span><span class="pun">=</span><span
                class="pln">xxx</span></code></li></ol></pre>
        <p data-anchor-id="5obx">4.需要把SpringSessionConfig类中的注释打开</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="9i5p"><ol class="linenums"><li class="L0"><code><span
                class="lit">@EnableRedisHttpSession</span><span class="pun">(</span><span class="pln">maxInactiveIntervalInSeconds </span><span
                class="pun">=</span><span class="pln"> </span><span class="lit">1800</span><span
                class="pun">)</span></code></li></ol></pre>
        <p data-anchor-id="odjv">5.如需配置session失效时间，请在SpringSessionConfig类中修改maxInactiveIntervalInSeconds属性值</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="bfpf" id="48-使用redis">4.8 使用Redis</h3>
        <p data-anchor-id="f9rc">默认Guns在部署分布式的环境中使用了Redis作为分布式session的存储，如果想在项目中用redis做缓存或者存储，建议使用RedisTemplate来进行操作</p>
        <p data-anchor-id="ipot">1.首先下载Redis服务端，可以在Guns的qq群里找到redis的可执行包，或者去redis官网下载 <br>
            2.在guns-admin项目添加对redis的依赖如下</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="lvkf"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="pun">&lt;</span><span class="pln">dependency</span><span class="pun">&gt;</span></code></li><li
                class="L1"><code class="language-java"><span class="pln">    </span><span class="pun">&lt;</span><span
                class="pln">groupId</span><span class="pun">&gt;</span><span class="pln">org</span><span
                class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">boot</span><span
                class="pun">&lt;/</span><span class="pln">groupId</span><span class="pun">&gt;</span></code></li><li
                class="L2"><code class="language-java"><span class="pln">    </span><span class="pun">&lt;</span><span
                class="pln">artifactId</span><span class="pun">&gt;</span><span class="pln">spring</span><span
                class="pun">-</span><span class="pln">boot</span><span class="pun">-</span><span
                class="pln">starter</span><span class="pun">-</span><span class="pln">data</span><span
                class="pun">-</span><span class="pln">redis</span><span class="pun">&lt;/</span><span class="pln">artifactId</span><span
                class="pun">&gt;</span></code></li><li class="L3"><code class="language-java"><span
                class="pun">&lt;/</span><span class="pln">dependency</span><span
                class="pun">&gt;</span></code></li></ol></pre>
        <p data-anchor-id="qeb1">3.在<code>application.yml</code>中配置redis的连接属性 <br>
            <img src="http://static.zybuluo.com/stylefeng/77crmjp1vrwakchxfjk25vpd/image_1c4teiq7e1ksl1tne1bn6159h1c9c1g.png"
                 alt="image_1c4teiq7e1ksl1tne1bn6159h1c9c1g.png-11.1kB" title=""> <br>
            4.在<code>GunsApplication</code>类中,注入RedisTemplate,并编写<code>CommandLineRunner</code>来测试一下Redis的连接，如下</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="ybc0"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="lit">@Bean</span></code></li><li class="L1"><code
                class="language-java"><span class="typ">CommandLineRunner</span><span
                class="pln"> commandLineRunner</span><span class="pun">()</span><span class="pln"> </span><span
                class="pun">{</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span
                class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span
                class="pln"> </span><span class="typ">CommandLineRunner</span><span class="pun">()</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code
                class="language-java"><span class="pln">        </span><span class="lit">@Override</span></code></li><li
                class="L4"><code class="language-java"><span class="pln">        </span><span
                class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span
                class="pln"> run</span><span class="pun">(</span><span class="typ">String</span><span
                class="pun">...</span><span class="pln"> strings</span><span class="pun">)</span><span
                class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span
                class="typ">Exception</span><span class="pln"> </span><span class="pun">{</span></code></li><li
                class="L5"><code class="language-java"><span class="pln">            </span><span class="typ">BoundValueOperations</span><span
                class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span
                class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span
                class="pln"> test </span><span class="pun">=</span><span class="pln"> redisTemplate</span><span
                class="pun">.</span><span class="pln">boundValueOps</span><span class="pun">(</span><span class="str">"test"</span><span
                class="pun">);</span></code></li><li class="L6"><code class="language-java"><span class="pln">            test</span><span
                class="pun">.</span><span class="pln">set</span><span class="pun">(</span><span
                class="str">"test value"</span><span class="pun">);</span></code></li><li class="L7"><code
                class="language-java"></code></li><li class="L8"><code class="language-java"><span
                class="pln">            </span><span class="typ">Object</span><span class="pln"> o </span><span
                class="pun">=</span><span class="pln"> test</span><span class="pun">.</span><span class="pln">get</span><span
                class="pun">();</span></code></li><li class="L9"><code class="language-java"><span
                class="pln">            </span><span class="typ">System</span><span class="pun">.</span><span
                class="pln">out</span><span class="pun">.</span><span class="pln">println</span><span
                class="pun">(</span><span class="pln">o</span><span class="pun">);</span></code></li><li
                class="L0"><code class="language-java"><span class="pln">        </span><span
                class="pun">}</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span
                class="pun">};</span></code></li><li class="L2"><code class="language-java"><span
                class="pun">}</span></code></li></ol></pre>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="2k99" id="49-xss过滤器">4.9 XSS过滤器</h3>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="403a" id="491-介绍">4.9.1 介绍</h4>
        <p data-anchor-id="l1i3">
            为了抵御XSS攻击，不让用户在录入数据的同时插入恶意js代码，Guns对所有传入数据中带有<code>html标签</code>和<code>&lt;script&gt;</code>标签的内容进行转义，转义后的内容并不是乱码，只是为了传入的html片段不会在渲染页面时让浏览器当成真正的脚本去执行。
        </p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="573f" id="492-原理">4.9.2 原理</h4>
        <p data-anchor-id="8y3m">防止XSS攻击的原理其实就是一个过滤器，对所有请求传来的参数进行正则校验，利用<code>replaceAll</code>把所有的请求中带有html标签的<code>&lt;</code>和<code>&gt;</code>等这种标识过滤为了<code>&amp;
            lt;</code>和<code>&amp; gt;</code>这种特殊符号.</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="ltpv" id="493-放过过滤">4.9.3 放过过滤</h4>
        <p data-anchor-id="ohwr">
            在<code>WebConfig</code>配置类中，找到<code>XssFilter</code>配置的地方，在<code>setUrlExclusion()</code>这里加上被放过过滤的列表即可 <br>
            <img src="http://static.zybuluo.com/stylefeng/o8xz4zbghsc32ekb76w5f1d7/image_1c4tfno2otcgpqe1lur17j1jec24.png"
                 alt="image_1c4tfno2otcgpqe1lur17j1jec24.png-92.6kB" title=""></p>
        <hr>
        <div class="md-section-divider"></div>
        <h2 data-anchor-id="fdvu" id="5-核心思想">5. 核心思想</h2>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="y1kc" id="51-分包">5.1 分包</h3>
        <p data-anchor-id="44jk">
            在日常开发中，业务模块的包结构划分一般划分为三个<code>config</code>、<code>core</code>、<code>modular</code>或者四个<code>common</code>、<code>config</code>、<code>core</code>、<code>modular</code>
        </p>
        <p data-anchor-id="3lf3">其中<code>common</code>为模块内通用的注解、常量、枚举、异常和持久化的实体等，若<code>common</code>不单独划分一个包，则可以把common包放到core包下面
        </p>
        <p data-anchor-id="cxly"><code>config</code>包存放整个模块的配置类，因为项目基于spring boot开发，大部分的spring配置都换成了java
            bean方式的配置，所以单独分一个包来存放配置，<code>config</code>包中除了存放配置类，还有一些以<code>Properties</code>结尾的类，这些类的作用是启动应用的时候把<code>application.yml</code>中的配置映射到类的属性上，使用时需要注意以下几点
            <br>
            <img src="http://static.zybuluo.com/stylefeng/yuwxewwyw5pbfk1qvjkc3zle/image_1c4t9rbev13cu136916qj1n6j1fr49.png"
                 alt="image_1c4t9rbev13cu136916qj1n6j1fr49.png-48.5kB" title=""></p>
        <p data-anchor-id="xjoa"><code>modular</code>存放按业务划分的业务代码，若本模块中包含多个模块业务，则在<code>modular</code>中建立多个业务包，在具体的业务包下再建立<code>controller</code>、<code>dao</code>、<code>service</code>、<code>transfer</code>、<code>wrapper</code>这几个包，其中<code>transfer</code>为前后端传输数据所用的属性封装，<code>wrapper</code>为对返回结果的包装器(下面会介绍到)，如果当前模块中只存在一类业务，那么没有必要在<code>modular</code>包下再建立多个业务模块，可直接在<code>modular</code>模块建立<code>controller</code>、<code>dao</code>、<code>service</code>、<code>transfer</code>、<code>wrapper</code>
        </p>
        <p data-anchor-id="14yx"><code>core</code>包存放当前模块所运行的一些<code>核心机制</code>，例如全局的异常拦截器，日志AOP，权限的AOP，项目初始化后的监听器，工具类等，还可以存放一些对某些框架的<code>扩展</code>，例如对beetl模板的扩展配置和工具类，对flowable的扩展类，Shiro的一些拓展类等等
        </p>
        <p data-anchor-id="lptt">这样拆分的好处在于把业务，配置和运行机制清晰的拆分开，提高项目的可维护性，加快项目的开发效率!</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="rdk6" id="52-统一异常拦截">5.2 统一异常拦截</h3>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="rba8" id="521-介绍">5.2.1 介绍</h4>
        <p data-anchor-id="jz5f">统一异常拦截指对程序抛出的异常利用<code>@ControllerAdvice</code>在统一的一个类中做<code>catch</code>处理，在Guns中，我们在<code>GlobalExceptionHandler</code>类中做统一异常拦截处理，<code>GlobalExceptionHandler</code>类中可以拦截所有控制器执行过程中抛出的异常，若需要拦截其他包下的异常可以参考<code>SessionInterceptor</code>这个类中AOP的写法，来拦截其他特定包的异常。统一异常拦截的写法注意一下几点
            <br>
            <img src="http://static.zybuluo.com/stylefeng/byd009eh0klcswyxnnec3zq0/image_1c4tcbdft270bih3pv1kuf1psh13.png"
                 alt="image_1c4tcbdft270bih3pv1kuf1psh13.png-74.8kB" title=""></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="p4rm" id="522-优点">5.2.2 优点</h4>
        <p data-anchor-id="j2uw">对异常进行统一处理，不需要再在业务代码中进行<code>try catch</code>操作，尽情写业务，有异常也会被自动拦截到，并且自动处理返回给前端提示</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="ugm7" id="523-关于性能">5.2.3 关于性能</h4>
        <p data-anchor-id="5epq">有人可能会认为利用异常拦截这种机制，把业务逻辑的错误都用业务异常抛出进入aop的执行器，对性能会有所影响，经过笔者的调研和测试，频繁的抛出异常和<code>try
            catch</code>不会有性能损耗，主要的性能损耗在<code>catch</code>方法内部，并且在<code>catch</code>内，记录日志比较占用大部分的时间</p>
        <p data-anchor-id="w68b">所以，如果是系统特别注重性能等问题，可以把业务异常分为两类，一类是<code>较为频繁抛出</code>的业务异常，一类是<code>较少出现次数</code>的业务异常，第一类异常可以再@ExceptionHandler中不做日志记录，只进行简单的返回操作，第二类可以着重做异常处理，并做结果返回
        </p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="d14b" id="53-结果包装器">5.3 结果包装器</h3>
        <p data-anchor-id="jgyi">我们在进行<code>列表查询</code>或<code>详情查询</code>的过程中，查到的结果中，有些值可能在数据库中存的是一些列数字(一般为状态值等)，但是我们要返回给前端，业务人员看的时候不希望直接返回给他们这些不直观的值(例如1，2，3，4)，我们更希望返回给前端中文名称(例如启用，冻结，已删除)，所以我们应该对这些数值做一下包装，把他们包装成文字描述
        </p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="cyba" id="531-如何使用">5.3.1 如何使用</h4>
        <p data-anchor-id="djcz">以查询用户列表的接口为例，不包装的情况下默认的查询结果为这些字段 <br>
            <img src="http://static.zybuluo.com/stylefeng/2apq6ixlk1lwg15mo8yot7kz/image_1c4tmpf94to7oesm17lo14rk9.png"
                 alt="image_1c4tmpf94to7oesm17lo14rk9.png-10.7kB" title=""> <br>
            其中性别，角色，部门，状态都是数值或者id类型，我们需要把他们包装成文字形式返回给前端</p>
        <p data-anchor-id="3dw1">1.首先建立<code>UserWrapper</code>类继承<code>BaseControllerWrapper</code>类</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="g7gc"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="com">/**</span></code></li><li class="L1"><code
                class="language-java"><span class="com"> * 用户管理的包装类</span></code></li><li class="L2"><code
                class="language-java"><span class="com"> *</span></code></li><li class="L3"><code class="language-java"><span
                class="com"> * @author fengshuonan</span></code></li><li class="L4"><code class="language-java"><span
                class="com"> * @date 2017年2月13日 下午10:47:03</span></code></li><li class="L5"><code class="language-java"><span
                class="com"> */</span></code></li><li class="L6"><code class="language-java"><span
                class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span
                class="pln"> </span><span class="typ">UserWrapper</span><span class="pln"> </span><span class="kwd">extends</span><span
                class="pln"> </span><span class="typ">BaseControllerWrapper</span><span class="pln"> </span><span
                class="pun">{</span></code></li><li class="L7"><code class="language-java"></code></li><li
                class="L8"><code class="language-java"><span class="pln">    </span><span class="kwd">public</span><span
                class="pln"> </span><span class="typ">UserWrapper</span><span class="pun">(</span><span
                class="typ">List</span><span class="pun">&lt;</span><span class="typ">Map</span><span
                class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span
                class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;&gt;</span><span class="pln"> list</span><span
                class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">        </span><span class="kwd">super</span><span
                class="pun">(</span><span class="pln">list</span><span class="pun">);</span></code></li><li
                class="L0"><code class="language-java"><span class="pln">    </span><span
                class="pun">}</span></code></li><li class="L1"><code class="language-java"></code></li><li
                class="L2"><code class="language-java"><span class="pln">    </span><span
                class="lit">@Override</span></code></li><li class="L3"><code class="language-java"><span
                class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span
                class="kwd">void</span><span class="pln"> warpTheMap</span><span class="pun">(</span><span class="typ">Map</span><span
                class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span
                class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span
                class="pln"> map</span><span class="pun">)</span><span class="pln"> </span><span
                class="pun">{</span></code></li><li class="L4"><code class="language-java"><span
                class="pln">        map</span><span class="pun">.</span><span class="pln">put</span><span
                class="pun">(</span><span class="str">"sexName"</span><span class="pun">,</span><span
                class="pln"> </span><span class="typ">ConstantFactory</span><span class="pun">.</span><span class="pln">me</span><span
                class="pun">().</span><span class="pln">getSexName</span><span class="pun">((</span><span class="typ">Integer</span><span
                class="pun">)</span><span class="pln"> map</span><span class="pun">.</span><span
                class="pln">get</span><span class="pun">(</span><span class="str">"sex"</span><span
                class="pun">)));</span></code></li><li class="L5"><code class="language-java"><span class="pln">        map</span><span
                class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span
                class="str">"roleName"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstantFactory</span><span
                class="pun">.</span><span class="pln">me</span><span class="pun">().</span><span
                class="pln">getRoleName</span><span class="pun">((</span><span class="typ">String</span><span
                class="pun">)</span><span class="pln"> map</span><span class="pun">.</span><span
                class="pln">get</span><span class="pun">(</span><span class="str">"roleid"</span><span
                class="pun">)));</span></code></li><li class="L6"><code class="language-java"><span class="pln">        map</span><span
                class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span
                class="str">"deptName"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstantFactory</span><span
                class="pun">.</span><span class="pln">me</span><span class="pun">().</span><span
                class="pln">getDeptName</span><span class="pun">((</span><span class="typ">Integer</span><span
                class="pun">)</span><span class="pln"> map</span><span class="pun">.</span><span
                class="pln">get</span><span class="pun">(</span><span class="str">"deptid"</span><span
                class="pun">)));</span></code></li><li class="L7"><code class="language-java"><span class="pln">        map</span><span
                class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span
                class="str">"statusName"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstantFactory</span><span
                class="pun">.</span><span class="pln">me</span><span class="pun">().</span><span class="pln">getStatusName</span><span
                class="pun">((</span><span class="typ">Integer</span><span class="pun">)</span><span
                class="pln"> map</span><span class="pun">.</span><span class="pln">get</span><span
                class="pun">(</span><span class="str">"status"</span><span class="pun">)));</span></code></li><li
                class="L8"><code class="language-java"><span class="pln">    </span><span
                class="pun">}</span></code></li><li class="L9"><code class="language-java"><span
                class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="r77v">通过查看<code>BaseControllerWrapper</code>类可了解到被包装的参数必须为Map或者List类型</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="v830"><ol class="linenums"><li class="L0"><code
                class="language-java"><span class="com">/**</span></code></li><li class="L1"><code
                class="language-java"><span class="com"> * 控制器查询结果的包装类基类</span></code></li><li class="L2"><code
                class="language-java"><span class="com"> *</span></code></li><li class="L3"><code class="language-java"><span
                class="com"> * @author fengshuonan</span></code></li><li class="L4"><code class="language-java"><span
                class="com"> * @date 2017年2月13日 下午10:49:36</span></code></li><li class="L5"><code class="language-java"><span
                class="com"> */</span></code></li><li class="L6"><code class="language-java"><span
                class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span
                class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BaseControllerWrapper</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code
                class="language-java"></code></li><li class="L8"><code class="language-java"><span
                class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span
                class="typ">Object</span><span class="pln"> obj </span><span class="pun">=</span><span
                class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li
                class="L9"><code class="language-java"></code></li><li class="L0"><code class="language-java"><span
                class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">BaseControllerWrapper</span><span
                class="pun">(</span><span class="typ">Object</span><span class="pln"> obj</span><span
                class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code
                class="language-java"><span class="pln">        </span><span class="kwd">this</span><span
                class="pun">.</span><span class="pln">obj </span><span class="pun">=</span><span class="pln"> obj</span><span
                class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span
                class="pun">}</span></code></li><li class="L3"><code class="language-java"></code></li><li
                class="L4"><code class="language-java"><span class="pln">    </span><span
                class="lit">@SuppressWarnings</span><span class="pun">(</span><span class="str">"unchecked"</span><span
                class="pun">)</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span
                class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> warp</span><span
                class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li
                class="L6"><code class="language-java"><span class="pln">        </span><span class="kwd">if</span><span
                class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span
                class="pun">.</span><span class="pln">obj </span><span class="kwd">instanceof</span><span
                class="pln"> </span><span class="typ">List</span><span class="pun">)</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code
                class="language-java"><span class="pln">            </span><span class="typ">List</span><span
                class="pun">&lt;</span><span class="typ">Map</span><span class="pun">&lt;</span><span
                class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span
                class="typ">Object</span><span class="pun">&gt;&gt;</span><span class="pln"> list </span><span
                class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span
                class="typ">List</span><span class="pun">&lt;</span><span class="typ">Map</span><span
                class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span
                class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;&gt;)</span><span
                class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span
                class="pln">obj</span><span class="pun">;</span></code></li><li class="L8"><code
                class="language-java"><span class="pln">            </span><span class="kwd">for</span><span
                class="pln"> </span><span class="pun">(</span><span class="typ">Map</span><span
                class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span
                class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span
                class="pln"> map </span><span class="pun">:</span><span class="pln"> list</span><span
                class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code
                class="language-java"><span class="pln">                warpTheMap</span><span class="pun">(</span><span
                class="pln">map</span><span class="pun">);</span></code></li><li class="L0"><code class="language-java"><span
                class="pln">            </span><span class="pun">}</span></code></li><li class="L1"><code
                class="language-java"><span class="pln">            </span><span class="kwd">return</span><span
                class="pln"> list</span><span class="pun">;</span></code></li><li class="L2"><code
                class="language-java"><span class="pln">        </span><span class="pun">}</span><span
                class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span
                class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span
                class="kwd">this</span><span class="pun">.</span><span class="pln">obj </span><span class="kwd">instanceof</span><span
                class="pln"> </span><span class="typ">Map</span><span class="pun">)</span><span
                class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code
                class="language-java"><span class="pln">            </span><span class="typ">Map</span><span
                class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span
                class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span
                class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span
                class="pun">(</span><span class="typ">Map</span><span class="pun">&lt;</span><span
                class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span
                class="typ">Object</span><span class="pun">&gt;)</span><span class="pln"> </span><span
                class="kwd">this</span><span class="pun">.</span><span class="pln">obj</span><span class="pun">;</span></code></li><li
                class="L4"><code class="language-java"><span class="pln">            warpTheMap</span><span class="pun">(</span><span
                class="pln">map</span><span class="pun">);</span></code></li><li class="L5"><code class="language-java"><span
                class="pln">            </span><span class="kwd">return</span><span class="pln"> map</span><span
                class="pun">;</span></code></li><li class="L6"><code class="language-java"><span
                class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span
                class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li
                class="L7"><code class="language-java"><span class="pln">            </span><span
                class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span
                class="pun">.</span><span class="pln">obj</span><span class="pun">;</span></code></li><li
                class="L8"><code class="language-java"><span class="pln">        </span><span
                class="pun">}</span></code></li><li class="L9"><code class="language-java"><span class="pln">    </span><span
                class="pun">}</span></code></li><li class="L0"><code class="language-java"></code></li><li
                class="L1"><code class="language-java"><span class="pln">    </span><span
                class="kwd">protected</span><span class="pln"> </span><span class="kwd">abstract</span><span
                class="pln"> </span><span class="kwd">void</span><span class="pln"> warpTheMap</span><span
                class="pun">(</span><span class="typ">Map</span><span class="pun">&lt;</span><span
                class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span
                class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> map</span><span
                class="pun">);</span></code></li><li class="L2"><code class="language-java"><span
                class="pun">}</span></code></li></ol></pre>
        <p data-anchor-id="im66">
            我们继承<code>BaseControllerWrapper</code>类主要是为了实现<code>warpTheMap()</code>方法，也就是具体的包装过程，<code>warpTheMap()</code>方法的参数map就是被包装的原始数据的每个条目，我们可以在这每个条目中增加一些字段也就是被包装字段的中文名称，如下
            <br>
            <img src="http://static.zybuluo.com/stylefeng/2gevgwg9qxp6hvzun2sxd00y/image_1c4tn697k14vjstnce46ge4tlm.png"
                 alt="image_1c4tn697k14vjstnce46ge4tlm.png-20.6kB" title=""></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="x3rd" id="532-constantfactory">5.3.2 ConstantFactory</h4>
        <p data-anchor-id="b3x0">在包装过程中，我们经常会用到<code>ConstantFactory</code>这个类，这个类是连接数据库和包装类的桥梁，我们可以在<code>ConstantFactory</code>中封装一些编辑的查询方法，这些方法通常会被多个包装类多次调用，并且在调用这些方法的时候<code>ConstantFactory.me()</code>的形式静态调用，可以快速的<code>包装一些状态和id</code>，非常方便，在ConstantFactory中我们可以利用spring
            cache的<code>@Cacheable</code>注解来缓存一些数据，把这些频繁的查询缓存起来</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="x5j8" id="54-前端思想">5.4 前端思想</h3>
        <p data-anchor-id="vcij">Guns前端采用了beetl模板引擎，beetl包含语法简洁，速度快，文档全，社区活跃等众多优点，所有的beetl语法都以<code>@</code>开头</p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="pbkk" id="541-布局">5.4.1 布局</h4>
        <p data-anchor-id="y7rb">在用户登录页面后进入的是<code>index.html</code>页面，这个页面加载了整个后台管理系统的框架，我们可以看到<code>index.html</code>源代码中把整个页面分为了三部分，左侧菜单栏，右侧页面和右侧主题栏部分，其实就是利用beetl的<code>@include</code>把整个大的复杂的页面细化了，这样好维护
        </p>
        <p data-anchor-id="nh19"><img
                src="http://static.zybuluo.com/stylefeng/k9w2ayw96cgj665kh12kftkc/image_1c4toquv31u2arfe154i9r811sf13.png"
                alt="image_1c4toquv31u2arfe154i9r811sf13.png-19.6kB" title=""></p>
        <p data-anchor-id="oq6v">左侧菜单和右侧主题栏部分在用户登录后会一直不变，除非刷新浏览器页面，动态变化的是页面右侧这部分，我们打开6个标签页，并打开浏览器F12调试</p>
        <p data-anchor-id="0d77"><img
                src="http://static.zybuluo.com/stylefeng/z1ew9cwudvvcpg82j7074mpk/image_1c4tpunc91mhp1kho9k71cen11b81g.png"
                alt="image_1c4tpunc91mhp1kho9k71cen11b81g.png-281.1kB" title=""></p>
        <p data-anchor-id="5h56">新建和切换标签，页面的地址不会变化，变化的是页面右侧的<code>iframe</code>这部分</p>
        <p data-anchor-id="jmop">下面我们分析一下右侧页面的组成，我们打开菜单管理页面，查看他的代码</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="sw7w"><ol class="linenums"><li class="L0"><code><span
                class="lit">@layout</span><span class="pun">(</span><span
                class="str">"/common/_container.html"</span><span class="pun">){</span></code></li><li class="L1"><code><span
                class="pun">&lt;</span><span class="pln">div </span><span class="kwd">class</span><span
                class="pun">=</span><span class="str">"row"</span><span class="pun">&gt;</span></code></li><li
                class="L2"><code><span class="pln">   XXXX</span><span class="pun">等</span><span class="pln">html</span><span
                class="pun">代码...</span></code></li><li class="L3"><code><span class="pun">&lt;/</span><span
                class="pln">div</span><span class="pun">&gt;</span></code></li><li class="L4"><code><span class="pun">&lt;</span><span
                class="pln">script src</span><span class="pun">=</span><span class="str">"${ctxPath}/static/modular/system/menu/menu.js"</span><span
                class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li
                class="L5"><code><span class="pun">@}</span></code></li></ol></pre>
        <p data-anchor-id="oz22">整个页面被<code>@layout</code>所包围，<code>@layout</code>是beetl的引用布局(具体用法文档可以查看beetl的官方文档)，Guns中内置了<code>/common/_container.html</code>这样一个布局，可以把<code>/common/_container.html</code>理解为一个html的抽象封装，我们每个页面都继承自这个模板，默认包含了一系列通用的js
            css引用等，这样写即简化了我们的开发和维护，又使我们的代码简洁有序，在<code>/common/_container.html</code>中的<code>${layoutContent}</code>就代表我们每个页面不同的html
        </p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="l9ci" id="542-标签">5.4.2 标签</h4>
        <p data-anchor-id="1w2d">为了把一些重复性的html封装起来，我们使用了beetl的标签，这些标签的<code>本质是把重复性的html代码用一行html标签替代</code>，从而方便使用，易于维护，这些标签都放在<code>common/tags</code>这个文件夹
            <br>
            <img src="http://static.zybuluo.com/stylefeng/ps8kwr6khknnr7xqmkwdcecd/image_1c4tr6i1ddgj1n6310on88c17pp2q.png"
                 alt="image_1c4tr6i1ddgj1n6310on88c17pp2q.png-26.5kB" title=""></p>
        <p data-anchor-id="7hgk">标签中的一些属性例如<code>${name}</code> <code>${id}</code>等属性均为掉钱被调用时，从调用体的属性传来<code>&lt;#xxxTag
            name="xxx" id="xxx"&gt;</code></p>
        <div class="md-section-divider"></div>
        <h4 data-anchor-id="jdd7" id="543-手动新增标签页">5.4.3 手动新增标签页</h4>
        <p data-anchor-id="3fqw">新版Guns提供了手动新增标签页的方法<code>HuiShu.newCrontab(href,menuName);</code>第一个参数是新打开tab页面的地址，第二个参数是新增tag页面的标签名称。
        </p>
        <p data-anchor-id="zjxp"><img
                src="http://static.zybuluo.com/stylefeng/0snjoiuhmqw72q64602xpa6j/image_1ch7na7ua1uor16hl1er14461cu2a.png"
                alt="image_1ch7na7ua1uor16hl1er14461cu2a.png-91.3kB" title=""></p>
        <hr>
        <div class="md-section-divider"></div>
        <h2 data-anchor-id="sqxr" id="6-常见问题答疑">6. 常见问题答疑</h2>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="4rq9" id="61-默认的系统登录账号和密码是多少">6.1 默认的系统登录账号和密码是多少</h3>
        <p data-anchor-id="rtfr">账号是<code>admin</code> 密码是<code>111111</code></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="jvyl" id="62-权限异常">6.2 权限异常</h3>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="zt0m" id="63-为何分页是前端实现">6.3 为何分页是前端实现</h3>
        <p data-anchor-id="6iag">部分页面因为数据量比较少，就直接用客户端分页了，日志页面的分页是采用服务端分页的，如果其他业务有特别需要，可以手动设置一下</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="tcgh" id="64-关于ctxpath">6.4 关于<code>${ctxPath}</code></h3>
        <p data-anchor-id="1ozh">这个变量在哪里定义的?这个是beetl自带的具体请看beetl文档</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="x2i5" id="65-放过某些url的权限验证">6.5 放过某些url的权限验证</h3>
        <p data-anchor-id="vne5">在ShiroConfig类下的shiroFilter方法里配置，参考<strong>4.2节</strong></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="h3i3" id="66-主页的搜索功能">6.6 主页的搜索功能</h3>
        <p data-anchor-id="cyb7">主页的搜索功能目前没有写实际业务，只是装饰作用</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="k13z" id="67-运行sql报错">6.7 运行sql报错</h3>
        <p data-anchor-id="6h6k">在初始化guns.sql过程中，可能会出现</p>
        <div class="md-section-divider"></div>
        <pre class="prettyprint linenums prettyprinted" data-anchor-id="656h"><ol class="linenums"><li class="L0"><code><span
                class="pun">[</span><span class="typ">Err</span><span class="pun">]</span><span
                class="pln"> </span><span class="lit">1067</span><span class="pln"> </span><span
                class="pun">-</span><span class="pln"> </span><span class="typ">Invalid</span><span class="pln"> </span><span
                class="kwd">default</span><span class="pln"> value </span><span class="kwd">for</span><span
                class="pln"> </span><span class="str">'createtime'</span></code></li></ol></pre>
        <p data-anchor-id="qmxs">这样的报错，Guns目前支持mysql 5.7的运行环境，若您的mysql低于此版本，请把<code>sys_expense</code>表的<code>DEFAULT
            CURRENT_TIMESTAMP</code>这部分语句去掉即可 <br>
            <img src="http://static.zybuluo.com/stylefeng/rr2aw8hrii01c8xvd120giax/image_1c4tuq72p1r1hfm41k9j1ppd8qh41.png"
                 alt="image_1c4tuq72p1r1hfm41k9j1ppd8qh41.png-52.2kB" title=""></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="85gu" id="68-关于打包">6.8 关于打包</h3>
        <p data-anchor-id="1a4l">Guns现在是多模块组成，各个模块之间有依赖关系，打包时，先修改guns-admin模块的pom的<code>&lt;packaging&gt;</code>节点，改为jar或者war
            <br>
            <img src="http://static.zybuluo.com/stylefeng/jrjlfoqn3hfsmhoibm2rpvnb/image_1c4tv3vhook81d3r1432jhh9m74e.png"
                 alt="image_1c4tv3vhook81d3r1432jhh9m74e.png-13.9kB" title=""></p>
        <p data-anchor-id="yfe1">再在<code>guns-parent</code>目录下输入<code>clean package -Dmaven.test.skip=true</code>来打出所有模块的包
            <br>
            <img src="http://static.zybuluo.com/stylefeng/43qly1znhlv4izgqpqjw328t/image_1c4tv625p1etf1v9212lb1osbd2e4r.png"
                 alt="image_1c4tv625p1etf1v9212lb1osbd2e4r.png-19.6kB" title=""></p>
        <p data-anchor-id="n3f1">执行成功后，在guns-admin目录下即可看到打好的包 <br>
            <img src="http://static.zybuluo.com/stylefeng/likciydn9330ytsbaaa78x24/image_1c4tv7fgi3pmjd4e565oucjq58.png"
                 alt="image_1c4tv7fgi3pmjd4e565oucjq58.png-24.3kB" title=""></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="vljs" id="69-查询结果的驼峰转化问题">6.9 查询结果的驼峰转化问题</h3>
        <p data-anchor-id="3ra8">直接参考<a
                href="http://baomidou.oschina.io/mybatis-plus-doc/#/question?id=%e5%bc%80%e5%90%af%e6%9f%a5%e8%af%a2%e7%bb%93%e6%9e%9c%e3%80%90%e4%b8%8b%e5%88%92%e7%ba%bf%e8%bd%ac%e9%a9%bc%e5%b3%b0%e3%80%91"
                target="_blank">mp的文档</a></p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="y6a6" id="610-为何使用beetl">6.10 为何使用beetl</h3>
        <p data-anchor-id="zki9"><a href="http://ibeetl.com/guide/#beetl" target="_blank">beetl</a>具有语法简介，性能超高，文档全，社区活跃等特点，所以建议用beetl模板引擎
        </p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="k588" id="611-为何有的业务没有service层">6.11 为何有的业务没有service层</h3>
        <p data-anchor-id="2zfq">部分业务比较简单，所以就没写service层，写service是为了让复杂业务更有条理，更清晰。(此项仅供参考)</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="6sxe" id="612-为何既有dao又有mapper">6.12 为何既有dao，又有mapper</h3>
        <p data-anchor-id="os1h">
            mapper是mybatis-plus自动生成的，里边有许多mybatis-plus增强的方法，dao是自己写的业务，mybatis-plus自动生成代码时会覆盖mapper，所以就把自己写的dao分开了，生成代码的时候不影响。(此项仅供参考)</p>
        <div class="md-section-divider"></div>
        <h3 data-anchor-id="ab00" id="613-提示springactive错误">6.13 提示@spring.active@错误</h3>
        <p data-anchor-id="htyz">请使用阿里云的maven仓库，并点击maven的reimport即可</p>
        <hr>
    </div>
    <div class="remark-icons">
    </div>
</div>

<!--in page preview buttons. -->
<div class="in-page-preview-buttons in-page-preview-buttons-full-reader">
    <ul>
        <li class="in-page-button dropdown" id="preview-toc-button" title="内容目录 Ctrl+Alt+O">
            <span class="dropdown-toggle icon-list" data-toggle="dropdown"></span>
            <div id="toc-list" class="dropdown-menu theme pull-right">
                <!-- Add theme means this element will be changed when apply theme color. -->
                <h3>内容目录</h3>
                <hr>
                <div class="table-of-contents"></div>
            </div>
        </li>
    </ul>
</div>

<div id="reader-full-toolbar" class="reader-full-toolbar-shown" style="padding-top: 0;">
    <ul id="reader-full-toolbar-home" class="preview-button-row">
        <li class="preview-button-full-reader" id="preview-editor-button" title="撰写文本 Ctrl+Alt+M">
            <span class="icon-pencil"></span>
        </li>
    </ul>
    <ul id="preview-button-row" class="preview-button-row">
        <li class="preview-button-full-reader dropdown" id="preview-list-button" title="文本列表 Ctrl+Alt+F">
            <span class="dropdown-toggle icon-reorder" data-toggle="dropdown"></span>
            <ul id="file-list" class="dropdown-menu theme-black pull-right" role="menu">
                <li>
                    <ul class="tag-list">
                        <li class="tag-item item" tag-name="stylefeng技术文档">
                            <span class="pull-left"><i class="icon-tag"></i><span class="tag-name">stylefeng技术文档</span></span>
                            <span class="tag-count pull-right">1</span>
                            <div class="clearfix"></div>
                        </li>

                        <li class="file-item item" file-created-date="2018-01-27T14:44:37.000000Z">
                            <a tabindex="-1" href="https://www.zybuluo.com/stylefeng/note/1028072"
                               title="【已发布】 2018-10-17T02:22:40.000000Z">
                                <i class="icon-share-sign"></i>
                                <span id="1028072" class="whiter-on-black">Guns 技术文档 v5.1</span>
                            </a>
                        </li>

                    </ul>
                </li>
            </ul>
            <ul id="file-list-topbar" class="dropdown-menu theme-black pull-right" role="menu">
                <li id="search-file-bar">
                    <i class="icon-search icon-large"></i>
                    <input type="text" id="search-file-textbox" placeholder="搜索 stylefeng 的文稿标题， * 显示全部">
                    <i class="icon-level-down icon-rotate-90 icon-large"></i>
                </li>
                <li id="tag-file-bar">
                    以下【标签】将用于标记这篇文稿：
                </li>
            </ul>
        </li>
        <li class="preview-button-full-reader" id="preview-theme-button" title="主题切换 Ctrl+Alt+Y">
            <span class="icon-adjust"></span>
        </li>
        <li class="preview-button-full-reader" id="preview-fullscreen-button" title="全屏模式 F11">
            <span class="icon-fullscreen"></span>
        </li>
        <li class="preview-button-full-reader wmd-spacer"></li>
        <li class="preview-button-full-reader dropdown" id="preview-about-button" title="关于本站">
            <span class="dropdown-toggle icon-info-sign" data-toggle="dropdown" data-hover="dropdown" data-delay="100"
                  data-close-others="true"></span>
            <ul id="about-menu" class="dropdown-menu theme-black pull-right" role="menu">
                <li title="下载全平台客户端"><a tabindex="-1" href="https://www.zybuluo.com/cmd" target="_blank"><i
                        class="icon-laptop"></i>下载客户端</a></li>
                <li title="@ghosert"><a tabindex="-1" href="http://www.weibo.com/ghosert" target="_blank"><i
                        class="icon-weibo"></i>关注开发者</a></li>
                <li title=""><a tabindex="-1" href="https://github.com/ghosert/cmd-editor/issues" target="_blank"><i
                        class="icon-github-alt"></i>报告问题，建议</a></li>
                <li title="support@zybuluo.com"><a tabindex="-1" href="mailto:support@zybuluo.com" target="_blank"><i
                        class="icon-envelope"></i>联系我们</a></li>
            </ul>
        </li>
    </ul>
</div>
<ul id="reader-full-toolbar-tail" class="reader-full-toolbar-tail-shown">
    <li class="preview-button-full-reader" id="preview-hidden-button" title="隐藏工具栏 Ctrl+Alt+I">
        <span class="icon-chevron-sign-right"></span>
    </li>
</ul>


<!-- side remark, hidden when loading. -->
<div class="remark-list side-remark-hidden">
    <div class="remark-items">
    </div>
    <div class="leave-remark unselectable"><span class='icon-plus-sign-alt'></span><span>添加新批注</span></div>
    <div class="new-remark">
        <!-- clone the template $('.new-remark-reply').html() to here.-->
        <div class="remark-notice">在作者公开此批注前，只有你和作者可见。</div>
    </div>
</div>

<!-- template for new remark/reply -->
<div class="new-remark-reply side-remark-hidden">
    <div class="remark-head"><a><img src="https://www.zybuluo.com/static/img/default-head.jpg"></a></div>
    <div class="remark-author unselectable"></div>
    <div class="remark-editor" contentEditable="true" spellcheck="false"></div>
    <!-- this will be filled up by js.
    <div class="inline-error">402/400</div> for new remark
    <div class="inline-error">202/200</div> for new reply
    -->
    <div class="remark-footer unselectable">
        <button class="remark-save btn-link">保存</button>
        <button class="remark-cancel btn-link">取消</button>
    </div>
</div>

<!-- template for .remark-item/.remark-reply -->
<div class="remark-item-reply side-remark-hidden">
    <div class="remark-head"><a><img src="https://www.zybuluo.com/static/img/default-head.jpg"></a></div>
    <div class="remark-author unselectable"></div>
    <div class="remark-delete-link unselectable"><span class="icon-remove"></span></div>
    <!--This is mainly for deleting remark-reply, shown when author/remark hovering on remark-reply.-->
    <div class="remark-editor" contentEditable="true" spellcheck="false"></div>
    <!-- this will be filled up by js.
    <div class="inline-error">402/400</div> for new remark
    <div class="inline-error">202/200</div> for new reply
    -->
    <div class="remark-footer unselectable">
        <button class="remark-edit btn-link">修改</button>
        <button class="remark-save btn-link">保存</button>
        <button class="remark-cancel btn-link">取消</button>
        <button class="remark-delete btn-link">删除</button>
    </div>
</div>

<!-- template for remark-item-->
<div class="remark-item side-remark-hidden" data-rand-id="" data-version-id="">
    <div class="remark-published-link unselectable"><span class="icon-link icon-rotate-90"></span></div>
    <ul class="remark-options theme unselectable">
        <li class="remark-private"><span class="icon-eye-close"></span><span>私有</span></li>
        <li class="remark-public"><span class="icon-group"></span><span>公开</span></li>
        <li class="remark-delete"><span class="icon-remove"></span><span>删除</span></li>
    </ul>

    <!-- clone the template $('.remark-item-reply').html() to here.-->

    <button class="remark-reply-view-more btn-link">查看更早的 5 条回复</button>
    <div class="remark-replies">
        <!--
        <div class="remark-reply">
            clone the template $('.remark-item-reply').html() to here.
        </div>
        -->
    </div>

    <div class="leave-reply unselectable"><span>回复批注</span></div>
    <div class="new-reply">
        <!-- clone the template $('.new-remark-reply').html() to here.-->
    </div>
</div>

<!-- jiawzhang NOTICE: .remark-icons will be put to mdeditor.mako and user_note.mako, where next to .wmd-preview -->
<!-- <div class="remark-icons"></div> -->

<!-- template for remark-icon -->
<div class="remark-icon unselectable side-remark-hidden remark-icon-empty" style="display: none;">
    <span class="icon-stack">
        <i class="glyph-comment"></i>
        <span class="remark-count"></span>
    </span>
</div>


<!-- canvas, hidden always, this is used to convert svg to canvas and then convert canvas to png. -->
<canvas id="svg-canvas-image" class="editor-reader-hidden-always"></canvas>

<!-- This is the image panel to hold enlarged image/svg. -->
<div id="large-image-panel">
    <img id="large-image"/>
</div>


<!-- Hidden Popup Modal -->
<div id="notification-popup-window" class="modal hide fade theme" tabindex="-1" role="dialog"
     aria-labelledby="notification-title" aria-hidden="true">
    <div class="modal-header theme">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="notification-title">通知</h3>
    </div>
    <div class="modal-body theme">
        <p></p>
    </div>
    <div class="modal-footer theme">
        <button id="notification-cancel" class="btn" data-dismiss="modal" aria-hidden="true">取消</button>
        <button id="notification-confirm" class="btn btn-primary">确认</button>
    </div>
</div>

<!-- zybuluo's foot -->

<script src="https://www.zybuluo.com/static/assets/288313bb.base.lib.min.js"></script>

<script>
    Namespace('com.zybuluo.base');
    com.zybuluo.base.initData = {
        globalPromptUrl: "https://www.zybuluo.com/global/prompt",
    };
</script>


<!--mathjax-->
<!--blacker: 1 below means font weight.-->
<script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]], processEscapes: true }, TeX: { equationNumbers: { autoNumber: "AMS" } }, messageStyle: "none", SVG: { blacker: 1 }});

</script>
<script src="https://www.zybuluo.com/static/editor/libs/mathJax.js"></script>
<!--mathjax source code is here: https://github.com/mathjax/MathJax.-->
<script src="https://www.zybuluo.com/static/MathJax/MathJax.js?config=TeX-AMS-MML_SVG"></script>

<script>
    Namespace('com.zybuluo.mdeditor.layout');
    com.zybuluo.mdeditor.layout.initData = {
        // '' means not logged in, otherwise the logged in username, for mdeditor.mako, this value will be reset in render.js otherwise, for user_note.mako, it's rendered by server side.
        loggedInUsername: '',
        isPageOwner: 'False' === 'True' ? true : false,
        loginComeFromUrl: 'https://www.zybuluo.com/login?return_to=https%3A%2F%2Fwww.zybuluo.com%2Fstylefeng%2Fnote%2F1028072',
        noteRemarksUrl: "https://www.zybuluo.com/note/1028072/remarks",
        newNoteRemarkUrl: "https://www.zybuluo.com/note/1028072/remark/new",
        updateNoteRemarkUrl: "https://www.zybuluo.com/note/1028072/remark/update",
        deleteNoteRemarkUrl: "https://www.zybuluo.com/note/1028072/remark/delete",
        publishNoteRemarkUrl: "https://www.zybuluo.com/note/1028072/remark/publish",
        newNoteRemarkReplyUrl: "https://www.zybuluo.com/note/1028072/remark_reply/new",
        updateNoteRemarkReplyUrl: "https://www.zybuluo.com/note/1028072/remark_reply/update",
        deleteNoteRemarkReplyUrl: "https://www.zybuluo.com/note/1028072/remark_reply/delete",
    };

    // BEGIN: pace.js configuration
    window.paceOptions = {
        // disable others, enable for ajax call only,
        ajax: true,
        document: false,
        elements: false,
        eventLag: false,
    };
    // jiawzhang NOTICE: to make sure pace.js is working for any ajax call especially the jquery ajax, add 'Pace.restart()' into jquery ajax call like '$.post'
    // Originally, pace 0.5.6 doesn't support jquery ajax, see details in: https://github.com/HubSpot/pace/issues/29
    // END: pace.js configuration

</script>

<script src="https://www.zybuluo.com/static/assets/mdeditor/7a70106e.layout.lib.min.js"></script>

<script src="https://www.zybuluo.com/static/assets/mdeditor/dc648f35.layout.min.js"></script>

<script>
    Namespace('com.zybuluo.mdeditor.user_note');
    com.zybuluo.mdeditor.user_note.initData = {
        isLoggedIn: 'False',
        mdeditorUrl: "https://www.zybuluo.com/mdeditor",
        passwordPassed: 'True' === 'True' ? true : false,
    };
</script>

<script src="https://www.zybuluo.com/static/assets/mdeditor/6cd3112e.user_note.min.js"></script>


</body>
</html>
    
